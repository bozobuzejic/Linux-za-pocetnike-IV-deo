PXE SERVER

PXE je klijent-server interfejs kojim pokrećemo instalaciju nekog operativnog sistema na više računara u mreži (sa jednog računara-servera)

PXE (Preboot eXecution Environment) Server omogućuje automatizovanu instalaciju nekog OS-a preko mreže

Postoji više načina za instaliranje i konfiguraciju PXE Servera: Dati primeri su rađeni na Ubuntu 16.04 i CentOS 7 server mašinama u VirtualBox-u 

------------------------------------------------------------------------------------------------------------------------------------------------------------------

1.PXE,TFTP,DHCP,DNSMASQ... - KONFIGURACIJA SERVERA 

------------------------------------------------------------------------------------------------------------------------------------------------------------------

   1.1.  Kreiranje PXE server-a
   
     1.1.1. Kreiranje Ubuntu PXE-TFTP servera za instalaciju OS u mreži sa DHCP podešavanjima za pokretanje instalacije na klijentu preko HTTP protokola
            (postupak sa kopiranjem instalacionog OS (ubuntu-16.04-server-amd64.iso) na PXE server) 
   
            Kreiramo i pokrenemo virtuelnu mašinu Ubuntu 16.04, podesimo mrežu: VB -> Settings -> Network -> Adapter 1 -> Bridged adapter; wlan0; Advanced; allow all 
            -> OK; kreiramo statičku adresu servera, izvršimo dhcp i tftp podešavanja, downloadujemo .iso fajl sa nekim operativnim sistemom (isprobano sa Ubuntu 
            15.04 server, Ubuntu 16.04.server i Ubuntu 17.04.server)

   
            sudo apt-get install network-manager
            sudo apt-get start network-manager
            sudo apt-get enable network-manager                                                            .....instaliramo network manager da bi smo pokrenuli NMTUI 
                                                                                                                alat

            nmtui -> Edit a connection -> Profile name Wired connection 1; Device 08:00:27:F6:48:C6 (enp0s3) -> edit -> Show -> ipv4 configuration ->  Manual -> 
            Adresses -> Add -> 192.168.0.49 ->  Gateway: 192.168.0.1 -> Dns servers -> Add -> 8.8.8.8 -> čekirati Automatically connect -> OK ---> back -> 
            -> Activate a connection -> back -> OK
               

            sudo apt-get install isc-dhcp-server apache2 tftpd-hpa lftp inetutils-inetd syslinux            .....instaliramo neophodne programe (dhcp, apache, tftp 
                                                                                                                 itd.)


            sudo vim /etc/default/isc-dhcp-server                                                           .....odredimo interfejs preko koga ide saobraćaj   
                 INTERFACES="enp0s3"

            sudo vim /etc/dhcp/dhcpd.conf                                                                   .....otvorimo konfiguracioni fajl za dhcpd.service 
                 ---------
                 default-lease-time 600;
                 max-lease-time 7200;
                 subnet 192.168.0.0 netmask 255.255.255.0 {                                                 .....definišemo ip adrese cele mreže
                 range 192.168.0.50 192.168.0.100;                                                          .....definišemo raspon mogućih adresa koje dhcp dodeljuje 
                 option subnet-mask 255.255.255.0;                                                                    
                 option routers 192.168.0.49;
                 option broadcast-address 192.168.0.255;
                 filename "pxelinux.0";
                 next-server 192.168.0.49;                                                                  .....adresa servera (statička koju smo dali sa nmtui)
                }
                 ----------
                 host bbubuntu {
                 hardware ethernet 08:00:27:f6:48:c6;
                 fixed-address 192.168.0.49;
                }
                 ---------
                 allow booting;
                 allow bootp;
                 option option-128 code 128 = string;
                 option option-129 code 129 = text;


      
            sudo vim /etc/inetd.conf                                                                              .....konfigurišemo inetd
                 tftp    dgram   udp wait    root    /usr/sbin/in.tftpd  /usr/sbin/in.tftpd -s /var/lib/tftpboot  .....dodajemo red na kraju dokumenta
       
            sudo update-inetd --enable BOOT                                                               .....apdejtujemo inetd servis

                                           
            sudo vim /etc/default/tftpd-hpa                                                               .....otvorimo konfiguracioni fajl za tftpd servis
                 TFTP_USERNAME="tftp"
                 TFTP_DIRECTORY="/var/lib/tftpboot"
                 TFTP_ADDRESS=":6900"
                 TFTP_OPTIONS="--secure"

                 RUN_DAEMON="yes"
                 TFTP_OPTIONS="192.168.0.49 --ipv4"                                                       .....dodati dve linije
                 ili                                                               
                 RUN_DAEMON=yes
                 TFTP_OPTIONS="-l -s /var/lib/tftpboot"
      
            cd /home/bozoubuntu/Downloads/                                                                                
            sudo wget http://old-releases.ubuntu.com/releases/16.04/ubuntu-16.04-server-amd64.iso
            sudo mount -o loop /home/bozoubuntu/Downloads/ubuntu-16.04-server-amd64.iso /mnt/             .....downloadujemo i montiramo .iso fajl

            cd /mnt/ 

            sudo cp -fr install/netboot/* /var/lib/tftpboot/                                              .....sve iz foldera install/netboot/* kopiramo u 
                                                                                                               /var/lib/tftpboot folder
            sudo mkdir /var/www/html/ubuntu
            sudo cp -fr /mnt/* /var/www/html/ubuntu/                                                      .....iskopiramo sve fajlove iz .iso fajla koji smo
                                                                                                               mountovali na /mnt/
            sudo vim /var/lib/tftpboot/pxelinux.cfg/default                                               .....otvorimo fajl 
                 label linux                                                                              .....dodamo na kraj dokumenta
                 kernel ubuntu-installer/amd64/linux
                 append ks=http://192.168.0.49/ks.cfg vga=normal initrd=ubuntu-installer/amd64/initrd.gz
                 ramdisk_size=16432 root=/dev/rd/0 rw  --

        

            sudo ufw allow 67
            sudo ufw allow 68                                                             .....omogućimo slušanje na portovima 80 i 443 za dhcp
            sudo ufw allow 80
            sudo ufw allow 443                                                            .....omogućimo slušanje na portovima 80 i 443 za apache2
            sudo ufw allow 69
            sudo ufw allow 6900
            sudo ufw allow 247                                                            .....omogućimo slušanje na portu 69 i 247 za tft

            sudo systemctl restart ufw                                                    .....restartujemo ufw servis

            sudo systemctl restart isc-dhcp-server.service                                .....restartujemo dhcp server                            

            sudo systemctl restart inetutils-inetd

            sudo systemctl restart tftpd-hpa                                              .....restartujemo tftp servis                                         

            reboot                                                                        .....restartujemo mašinu

 
            Na realnoj mašini koja je u istoj mreži kao mašine u VirtualBox-u -> Web browser -> http://192.168.0.49/ubuntu       
                                                                                          .....prikazuje se sadržaj foldera ubuntu sa 
                                                                                               instalacionim fajlovima
   
~~~~~~~~~~~~~~~~~~~~
   
   
     1.1.2. Kreiranje Ubuntu PXE-TFTP servera za instalaciju OS u mreži preko NETBOOT-a iz repozitorijuma sa interneta (bez snimanja instalacionog .iso na mašinu -
            kreiranje Ubuntu PXE servera bez kopiranja instalacionog OS - Debian 9 (Stretch): instlacioni fajlovi se povlače sa interneta)
            Kreiramo i pokrenemo virtuelnu mašinu Ubuntu 17.04, podesimo mrežu: VB -> Settings -> Network -> Adapter 1 -> Bridged adapter; wlan0; Advanced; allow all 
            -> OK; kreiramo statičku adresu servera, izvršimo dhcp i tftp podešavanja
   
            sudo vim /etc/network/interfaces                                              .....kreiramo statičku IP adresu servera
                 auto enp0s3
                 iface enp0s3 inet static
                 address 192.168.0.60
                 netmask 255.255.255.0
                 network 192.168.0.0
                 broadcast 192.168.0.255
                 gateway 192.168.0.1
                 dns-nameservers 8.8.8.8 8.8.4.4
        
           sudo ifdown enp0s3
           sudo ifup enp0s3                                                               .....restartujemo vezu
           ip a
   
           sudo apt install wget bash-completion unzip                                    .....instaliramo potrebne alate (ako već nisu instalirani)
   
   sudo apt apt install isc-dhcp-server                                                   .....instaliramo dhcp servis
   
   sudo mv /etc/dhcp/dhcpd.conf /etc/dhcp/dhcpd.conf.backup
   
   sudo vim /etc/dhcp/dhcpd.conf                                                          .....konfigurišemo dhcp servis
        ddns-update-style none;
        option option-128 code 128 = string;
        option option-129 code 129 = text;
        authoritative;
        log-facility local7;
        option arch code 93 = unsigned integer 16;
 
        subnet 192.168.0.0 netmask 255.255.255.0 {
        range 192.168.0.70 192.168.0.100;
        option routers 192.168.0.1;
        option broadcast-address 192.168.0.255;
        option subnet-mask 255.255.255.0;
        option ntp-servers 192.168.0.60;
        option time-servers 192.168.0.60;
        option domain-name-servers 192.168.0.1;
        allow booting;
        allow bootp;
        if option arch = 00:07 or option arch = 00:09 {
        filename "bootnetx64.efi";                                                          .....|---> opcija za mašine zasnovane na UEFI * 
      } else {                                                                                   | 
        filename "pxelinux.0";                                                              .....|---> opcija za mašine sa starijim BIOS sistemom *
      }
        next-server 192.168.0.60;
        default-lease-time 14400;
        max-lease-time 28800;
        }
        host ubuntu {
        hardware ethernet 08:00:27:80:94:c5;
        fixed-address 192.168.0.60;                                                         .....next server i host ubuntu su ista mašina - server sa kogase pokreće
      }                                                                                          instalacija na mašini-klijentu
      
   
   sudo vim /etc/default/isc-dhcp-server
        INTERFACESv4=”enp0s3”
        
   sudo systemctl restart isc-dhcp-server.service
   sudo systemctl status isc-dhcp-server.service                                            .....restartujemo servis      
    
   sudo apt install tftpd-hpa                                                               .....instaliramo tftp servis
   
   sudo vim /etc/default/tftpd-hpa                                                          .....proverimo konfiguraciju
        TFTP_USERNAME="tftp"
        TFTP_DIRECTORY="/srv/tftp"
        TFTP_ADDRESS=":69"
        TFTP_OPTIONS="--secure"
        
   sudo systemctl enable tftpd-hpa
   sudo systemctl start tftpd-hpa                                                           .....omogućimo i startujemo tftp servis
   sudo systemctl status tftpd-hpa 
   
   sudo ufw allow 67/udp
   sudo ufw allow 69/udp                                                                    .....omogućimo navedeno portove i firewall-u
    
   sudo mkdir Downloads
   cd Downloads
   sudo wget http://ftp.nl.debian.org/debian/dists/stretch/main/installer-amd64/current/images/netboot/netboot.tar.gz      .....downloadujemo netboot za Debian 9
   
   sudo mkdir /srv/tftp/
   
   sudo tar xfz netboot.tar.gz -C /srv/tftp/                                                .....sadržaj netboot.tar.gz raspakujemo u tftp folder
   
   sudo apt install syslinux-utils syslinux                                                 .....instaliramo syslinux sa pripadajućim alatima
   sudo cp /usr/lib/syslinux/memdisk /srv/tftp/                                             .....iskopiramo fajl memdisk u tftp folder
   
   sudo ln -s /srv/tftp/debian-installer/amd64/bootnetx64.efi /srv/tftp/                    .....kreiramo link od bootnetx64.efi u tftp folder
   
   sudo vim /srv/tftp/debian-installer/amd64/boot-screens/txt.cfg                           .....konfigurišemo sliku boot ekrana
        label install
        menu label ^Install
        kernel debian-installer/amd64/linux
        append vga=788 initrd=debian-installer/amd64/initrd.gz --- quiet
        
        label rescue
        menu label ^Rescue mode
        kernel debian-installer/amd64/linux
        append vga=788 initrd=debian-installer/amd64/initrd.gz rescue/enable=true --- quiet
        
        label expert
        menu label ^Expert install
        kernel debian-installer/amd64/linux
        append priority=low vga=788 initrd=debian-installer/amd64/initrd.gz --- 
        include debian-installer/amd64/boot-screens/rqtxt.cfg
        
        label auto
        menu label ^Automated install
        kernel debian-installer/amd64/linux
        append auto=true priority=critical vga=788 initrd=debian-installer/amd64/initrd.gz --- quiet 
        
             
   * Podsećanje: Syslinux je pokretački program za BIOS podizanje sistema (kada se instalacioni .iso fajl pokreće na računaru sa BIOS-om).
                 Koristi se za 32 i 64 bitne verzije na particijama formatiranim u FAT32 fajl sistemu. 
               
                 Grub2 se koristi za sisteme sa UEFI pokretanjem.
                 Grub se koristi kada se instalacioni .iso fajl pokreće na mašini koja podržava EFI.
                    
        
~~~~~~~~~~~~~~~~~~~~
 
    1.1.3. Kreiranje PXE-DNSMASQ server-a za pokretanje instalacije OS na klijentu preko HTTP protokola
           Kreiranje Ubuntu PXE servera sa DNSMASQ (DNS forwarder and DHCP server) za instalaciju OS u mreži 
           (postupak sa kopiranjem instalacionog OS (ubuntu-16.04-server-amd64.iso ili ubuntu-17.04-server-amd64.iso) na PXE server
           i postupak sa konfigurisanjem za pokretanje instalacije iz repozitorijuma) 
   
    Nakon kreiranja i pokretanja virtuelne mašine Ubuntu 16.04 (VB -> Settings -> Network -> Adapter 1 -> Bridged adapter; wlan0; Advanced; allow all -> OK)
    kreiramo statičku adresu servera, izvršimo dhcp i tftp podešavanja, downloadujemo .iso fajl sa operativnim sistemom (Ubuntu 16.04. ili Ubuntu 17.04.) 
   
    sudo vim /etc/network/interfaces                                                            .....konfigurišemo statičku IP adresu servera
        auto enp0s3
        iface enp0s3 inet static
        address 192.168.0.49
        netmask 255.255.255.0
        network 192.168.0.0
        broadcast 192.168.0.255
        gateway 192.168.0.1
        dns-nameservers 8.8.8.8 8.8.4.4

     sudo apt install isc-dhcp-server tftpd-hpa 
   
     sudo apt install dnsmasq                                                                    .....instaliramo servis dnsmasq
     sudo mv /etc/dnsmasq.conf /etc/dnsmasq.conf.backup                                          .....preimenujemo originalni konfiguracioni fajl

     sudo vim /etc/dnsmasq.conf                                                                  .....kreiramo novi konfiguracioni fajl
        interface=enp0s3,lo                                                                           .....odredimo mrežni interfejs
        bind-interfaces
        domain=bbubuntu.lab
        dhcp-range=enp0s3,192.168.0.50,192.168.0.100,255.255.255.0,1h                                 .....definišemo raspon ip adresa rezervisanih za klijente
        dhcp-option=3,192.168.0.1
        dhcp-option=6,192.168.0.1                                                                     .....gateway
        dhcp-option=6,8.8.8.8
        server=8.8.4.4
        dhcp-option=28,192.168.0.255                       
        dhcp-option=42,0.0.0.0
        dhcp-boot=pxelinux.0,pxeserver,192.168.0.49                                               .....adresa servera sa kog ide instalacija
        pxe-prompt="Press F8 for menu.", 2
        pxe-service=x86PC, "Install Ubuntu 16.04 from network server 192.168.0.49", pxelinux
        enable-tftp
        tftp-root=/srv/tftp                                                                       
        
     sudo mkdir /srv/tftp                                                                         .....kreiramo tftp folder u koji će se smestiti netboot fajlovi

     sudo systemctl restart dnsmasq.service
     sudo systemctl enable dnsmasq.service
     sudo systemctl status dnsmasq.service                                                        .....omogućimo i pokrenemo dnsmasq.service

     cd Downloads
     sudo wget http://old-releases.ubuntu.com/releases/16.04.3/ubuntu-16.04-server-amd64.iso
     sudo mount -o loop ubuntu-16.04-server-amd64.iso /mnt/                                                  
     ili 
     sudo wget http://old-releases.ubuntu.com/releases/17.04/ubuntu-17.04-server-amd64.iso
     sudo mount -o loop ubuntu-17.04-server-amd64.iso /mnt/                                       .....downloadujemo i mountujemo OS.iso fajl 
     ls /mnt/
     sudo cp -rf /mnt/install/netboot/* /srv/tftp/                                                .....iskopiramo sadržaj netboot direktorijuma u tftp direktorijum

     sudo mkdir /var/www/html/ubuntu/                                                             .....kreiramo folder ubuntu u roditeljskom direktorijumu html 
                                                                                                       stranica koji je kreirao apache2 servis
                                                                                                      
     sudo cp -fr /mnt/* /var/www/html/ubuntu/                                                     .....sadržaj .iso fajla koji smo montirali u /mnt/ kopiramo u folder
                                                                                                 
     sudo vim /var/www/html/ubuntu/preseed/local-sources.seed                                     .....izvršimo konfiguraciju instalacionih fajlova
        d-i live-installer/net-image string http://192.168.0.49/ubuntu/install/filesystem.squashfs
        
     sudo vim /srv/tftp/ubuntu-installer/amd64/boot-screens/txt.cfg
        ---------------------
        #append vga=788 initrd=ubuntu-installer/amd64/initrd.gz --- quiet
        append auto=true url=http://192.168.0.49/ubuntu/preseed/local-sources.seed vga=788 initrd=ubuntu-installer/amd64/initrd.gz --- quiet
        
     sudo vim /srv/tftp/ubuntu-installer/amd64/boot-screens/rqtxt.cfg
        --------------------
        #append vga=788 initrd=ubuntu-installer/amd6si4/initrd.gz rescue/enable=true --- quiet
        append auto=true url=http://192.168.0.49/ubuntu/preseed/local-sources.seed vga=788 initrd=ubuntu-installer/amd64/initrd.gz rescue/enable=true --- quiet
        
     sudo vim /srv/tftp/ubuntu-installer/amd64/boot-screens/menu.cfg
        #menu hshift 13
        #menu width 49
        #menu margin 8
        -----------------
        
     sudo ufw allow 53/tcp
     sudo ufw allow 53/udp
     sudo ufw allow 67/udp
     sudo ufw allow 69/udp
     sudo ufw allow 4011/udp
     sudo systemctl reload ufw                                                                   .....omogućimo slušanje na navedenim portovima

     reboot                                                                                      .....restartujemo server

     Na realnoj mašini koja je u istoj mreži kao mašine u VirtualBox-u -> Web browser -> http://192.168.0.49/ubuntu      .....prikazuje se sadržaj foldera ubintu sa 
                                                                                                                              instalacionim fajlovima

~~~~~~~~~~~~~~~~~~~
                                                                                                                           
    1.1.4. Kreiranje PXE-DNSMASQ server-a za pokretanje instalacije na klijentu preko FTP protokola i mirror instalacionog repozitorijuma
           Kreiranje CentOS7 PXE servera sa DNSMASQ (DNS forwarder and DHCP server) za instalaciju OS u mreži 
           (postupak sa kopiranjem instalacionog OS (CentOS-8.3.2011-x86_64-dvd1.iso) na PXE server) 

           Tokom kreiranja i pokretanja virtuelne mašine CentOS7 (VB -> Settings -> Network -> Adapter 1 -> Bridged adapter; wlan0; Advanced; allow all -> OK)
           kreiramo statičku adresu servera a onda izvršimo dhcp i tftp podešavanja, downloadujemo .iso fajl sa operativnim sistemom (CentOS7) 
       
       
    sudo yum install dnsmasq
    sudo mv /etc/dnsmasq.conf  /etc/dnsmasq.conf.backup                                           .....instaliramo servis dnsmasq

    sudo vim /etc/dnsmasq.conf                                                                    .....kreiramo konfiguracioni fajl                                                          
            interface=enp0s3,lo
            bind-interfaces
            domain=boza.lab
            dhcp-range=enp0s3,192.168.0.60,192.168.0.100,255.255.255.0
            dhcp-option=3,192.168.0.1
            dhcp-option=6,192.168.0.1
            dhcp-option=6,8.8.8.8
            server=8.8.4.4
            dhcp-option=28,192.168.0.255
            dhcp-option=42,0.0.0.0
            dhcp-boot=pxelinux.0,pxeserver,192.168.0.50
            pxe-prompt="Press F8 for menu.", 60
            pxe-service=x86PC, "Install CentOS 8 from network server 192.168.0.50", pxelinux
            enable-tftp
            tftp-root=/var/lib/tftpboot


    sudo yum install syslinux                                                                     .....kreiramo syslinux boot loader

    sudo yum install tftp-server                                                                  .....instaliramo tftp servis za razmenu fajlova između računara

    sudo cp -r /usr/share/syslinux/* /var/lib/tftpboot 
    
    sudo mkdir /var/lib/tftpboot
    
    sudo mkdir /var/lib/tftpboot/pxelinux.cfg                                                     .....kreiramo folder za default fajl tftp i pxe servisa

    sudo vim /var/lib/tftpboot/pxelinux.cfg/default                                               .....kriramo default konfiguracioni fajl za tftp i pxe koji 
            default menu.c32                                                                          će uz pomoć vmlinuz i initrd.img fajlova pokrenuti instalaciju
            prompt 0
            timeout 300
            ONTIMEOUT local

            menu title ########## PXE Boot Menu ##########

            label 1                                                                              .....podešavanje u label 1 vodi do instalacije sa servera na
            menu label ^1) Install CentOS 8 x64 with Local Repo                                       klijente
            kernel centos8/vmlinuz
            append initrd=centos7/initrd.img method=ftp://192.168.0.50/pub devfs=nomount

            label 2                                                                              .....podešavanje u label 2 vodi do instalacije sa interneta (mirror)
            menu label ^2) Install CentOS 8 x64 with http://mirror.centos.org Repo                    na klijente
            kernel centos8/vmlinuz                                                                    
            append initrd=centos8/initrd.img method=http://mirror.centos.org/centos/8.3.2011/BaseOS/x86_64/os/ devfs=nomount ip=dhcp
                                                    
            label 3
            menu label ^4) Boot from local drive

     sudo yum install wget
   
     cd /home/bozo/Downloads
   
     sudo wget http://mirror.etf.bg.ac.rs/centos/8.3.2011/isos/x86_64/CentOS-8.3.2011-x86_64-dvd1.iso  .....downloadujemo instalacioni .iso fajl za CentOS 8
   
     sudo mount -o loop CentOS-8.3.2011-x86_64-dvd1.iso /mnt                                           .....montiramo .iso fajl u /mnt/
   
     sudo mkdir /var/lib/tftpboot/centos7
     sudo cp /mnt/images/pxeboot/vmlinuz /var/lib/tftpboot/centos7
     sudo cp /mnt/images/pxeboot/initrd.img /var/lib/tftpboot/centos7
   
     sudo mkdir /var/lib/tftpboot/centos8
     sudo cp /mnt/images/pxeboot/vmlinuz /var/lib/tftpboot/centos8
     sudo cp /mnt/images/pxeboot/initrd.img /var/lib/tftpboot/centos8
   
     sudo yum install vsftpd
     sudo cp -r /mnt/*  /var/ftp/pub/ 
     sudo chmod -R 755 /var/ftp/pub

     sudo umount CentOS-8.3.2011-x86_64-dvd1.iso /mnt
   
   
     sudo systemctl enable dnsmasq
     sudo systemctl start dnsmasq
     sudo systemctl enable vsftpd
     sudo systemctl start vsftpd
   
     sudo vim /etc/selinux/config
            #SELINUX=enforcing                                                       .....zakomentarišemo liniju
            SELINUX=permissing                                                       .....dodamo liniju
            #SELINUXTYPE=targeted                                                    .....zakomentarišemo liniju


     sudo firewall-cmd --add-service=ftp --permanent                                  .....omogućimo port 21 za ftp servis
     sudo firewall-cmd --add-service=dns --permanent                                  .....omogućimo port 53 za dns servis
     sudo firewall-cmd --add-service=dhcp --permanent                                 .....omogućimo port 67 za dhcp servis
     sudo firewall-cmd --add-port=69/udp --permanent                                  .....omogućimo port 69 za TFTP
     sudo firewall-cmd --add-port=4011/udp --permanent                                .....omogućimo port 4011 za ProxyDHCP
     sudo firewall-cmd --reload                                                       .....primenimo nova pravila
                                                                                                                   


~~~~~~~~~~~~~~~~~~~~~



    1.1.5. Kreiranje PXE-DNSMASQ server-a za pokretanje automatske instalacije na klijentu preko FTP protokola uz pomoć KICKSTART metoda
           (postupak sa kopiranjem instalacionog OS (CentOS-8.3.2011-x86_64-dvd1.iso) na PXE server) 

           Tokom kreiranja i pokretanja virtuelne mašine CentOS7 (VB -> Settings -> Network -> Adapter 1 -> Bridged adapter; wlan0; Advanced; allow all -> OK)
           kreiramo statičku adresu servera a onda izvršimo dhcp i tftp podešavanja, downloadujemo .iso fajl sa operativnim sistemom (CentOS8) 
        
           
    sudo yum install dnsmasq tftp tftp-server syslinux wget vsftpd xinetd                         .....instaliramo potrebne servise
    
    sudo mv /etc/dnsmasq.conf  /etc/dnsmasq.conf.backup                                           
    
    sudo vim /etc/dnsmasq.conf                                                                    .....kreiramo konfiguracioni fajl dnsmasq server                                                         
           interface=enp0s3,lo
           bind-interfaces
           domain=boza.lab
           dhcp-range=enp0s3,192.168.0.60,192.168.0.100,255.255.255.0
           dhcp-option=3,192.168.0.1
           dhcp-option=6,192.168.0.1,8.8.8.8
           server=8.8.4.4
           dhcp-option=28,192.168.0.255
           dhcp-option=42,0.0.0.0
           dhcp-boot=pxelinux.0,pxeserver,192.168.0.50
           pxe-prompt="Press F8 for menu.", 60
           pxe-service=x86PC, "Install CentOS 8 from network server 192.168.0.50", pxelinux
           enable-tftp
           tftp-root=/var/lib/tftpboot


    sudo vim /etc/xinetd.d/tftp                                                                   .....otvorimo xinetd servis za upravljanje internet konekcijom
           service tftp
          {
           socket_type             = dgram
           protocol                = udp
           wait                    = yes
           user                    = root
           server                  = /usr/sbin/in.tftpd
           server_args             = -s /var/lib/tftpboot
           disable                 = no                                                                .....promenim komandu disable sa yes na no
           per_source              = 11
           cps                     = 100 2   
           flags                   = IPv4
          }

    sudo mkdir -p /var/lib/tftpboot/
    sudo mkdir /var/lib/tftpboot/pxelinux.cfg
    sudo mkdir /var/lib/tftpboot/netboot/                                                              .....kreiramo navedene direktorijuma
    sudo cp -r /usr/share/syslinux/* /var/lib/tftpboot                                                 .....iskopiramo sadržaj syslinix boot loadera u /tftpboot/

    cd /home/bozo/Downloads   
    sudo wget http://mirror.etf.bg.ac.rs/centos/8.3.2011/isos/x86_64/CentOS-8.3.2011-x86_64-dvd1.iso   .....downloadujemo instalacioni .iso fajl za CentOS 8
    sudo mount -o loop /home/bozo/Downloads/CentOS-8.3.2011-x86_64-dvd1.iso /mnt                       .....montiramo .iso fajl

    sudo cp -r /mnt/* /var/ftp/pub/                                                               .....iz 3 koraka snimimo sadržaj instalacionog .iso fajla
    sudo cp -r /mnt/.discinfo  /var/ftp/pub/
    sudo cp -r /mnt/.treeinfo  /var/ftp/pub/
    sudo chmod -R 755 /var/ftp/pub                                                                .....promenimo dozvole za /pub direktorijum

    sudo umount CentOS-8.3.2011-x86_64-dvd1.iso /mnt                                              .....umountujemo .iso fajl

    sudo cp /var/ftp/pub/images/pxeboot/vmlinuz /var/lib/tftpboot/netboot/
    sudo cp /var/ftp/pub/images/pxeboot/initrd.img /var/lib/tftpboot/netboot/                     .....iskopiramo vmlinuz i initrd.img fajlove u hetboot folder

    sudo vim /var/lib/tftpboot/pxelinux.cfg/default                                               .....kriramo default konfiguracioni fajl za tftp i pxe koji 
            default menu.c32                                                                           će uz pomoć vmlinuz i initrd.img fajlova pokrenuti instalaciju
            prompt 0
            timeout 300
            ONTIMEOUT local

            menu title ########## PXE Boot Menu ##########

            label 1
            menu label ^1) Install CentOS 8 x64 with Local Repo
            kernel netboot/vmlinuz
            append initrd=netboot/initrd.img method=ftp://192.168.0.50/pub devfs=nomount ks=ftp://192.168.0.50/pub/ks.cfg
                                                                                                                       .....odredimo da instalacija ide sa ftp servera
                                                                                                                            sa kickstart-m (ks.cfg konfiguracioni 
                                                                                                                            fajl) 
            

    sudo openssl passwd -1 "123456"
    $1$s6XDzhDg$aGyr0wIpocpYZRo6UE1Wf/                                                                                  .....kreiramo password za za root-a (sudo...)
 
    openssl passwd -1 "111111"
    $1$FXZoiWS3$.twWtb1Ac6Ew7rJQvaswY/                                                                                  .....kreiramo password za usera (bez sudo...)


    sudo vim /var/ftp/pub/ks.cfg                                                                                        .....konfigurišemo kickstart komandu
            #version=RHEL8
            #ignoredisk --only-use=sda
            # Partition clearing information
            clearpart --all --initlabel
            # Use text install
            text                                                                                                        .....odredimo da instalacija bude tekstuelna
            # Keyboard layouts
            keyboard --vckeymap=us --xlayouts='us'                                                                      .....odredimo tastaturu
            # System language
            lang en_US.UTF-8                                                                                            .....odredimo jezik sistema

            # Network information
            network  --bootproto=dhcp --device=link --ipv6=auto --activate
            network  --hostname=localhost
            # Use network installation
            url --url="ftp://192.168.0.50/pub/"                                                                         .....upišemo adresu ftp servera
            # Root password [i used here 123456]
            rootpw --iscrypted $1$s6XDzhDg$aGyr0wIpocpYZRo6UE1Wf/                                                       .....upišemo password za root-a
            # Disable the Setup Agent on first boot
            firstboot --disable
            # Accept Eula
            eula --agreed
            # Reboot when the install is finished.
            reboot
            # Do not configure the X Window System
            skipx
            # System services
            services --enabled="chronyd"
            # System timezone
            timezone Europe/Belgrade --isUtc --ntpservers=_gateway                                                           .....dodamo vremensku zonu
            user --groups=wheel --name=bozo --password=$1$FXZoiWS3$.twWtb1Ac6Ew7rJQvaswY/ --iscrypted --gecos="bozo"         .....dodamo usera sa passwordom
            # Disk partitioning information
            part /boot --fstype="ext4" --size=1024
            part pv.01 --fstype="lvmpv" --grow
            volgroup cl pv.01
            logvol / --fstype="xfs" --name=root --vgname=cl --size=20000
            logvol /tmp --fstype="xfs" --name=tmp --vgname=cl --size=5000
            logvol /var/log --fstype="xfs" --name=log --vgname=cl --size=2000                                                .....odredimo veličine diskova
            # or one volume used 100% of disk space 
            # logvol / --fstype="xfs" --name=root --vgname=cl --percent=100 --grow
            # if system used EFI
            # part /boot/efi --fstype=efi --grow --maxsize=200 --size=20

            %packages
            @^minimal-environment
            @standard

            %end

            %addon com_redhat_kdump --disable --reserve-mb='auto'

            %end

            %anaconda
            pwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty
            pwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok
            pwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty
            %end


    sudo systemctl enable dnsmasq
    sudo systemctl start dnsmasq
    sudo systemctl enable vsftpd
    sudo systemctl start vsftpd
    sudo systemctl enable xinetd
    sudo systemctl start xinetd                                                      .....omogučimo i pokrenemo servise

    sudo vim /etc/selinux/config
            #SELINUX=enforcing                                                       .....zakomentarišemo liniju
            SELINUX=permissing                                                       .....dodamo liniju
            #SELINUXTYPE=targeted                                                    .....zakomentarišemo liniju


    sudo firewall-cmd --add-service=ftp --permanent                                  .....omogućimo port 21 za ftp servis
    sudo firewall-cmd --add-service=dns --permanent                                  .....omogućimo port 53 za dns servis
    sudo firewall-cmd --add-service=dhcp --permanent                                 .....omogućimo port 67 za dhcp servis
    sudo firewall-cmd --add-port=69/udp --permanent                                  .....omogućimo port 69 za TFTP
    sudo firewall-cmd --add-port=4011/udp --permanent                                .....omogućimo port 4011 za ProxyDHCP
    sudo firewall-cmd --reload                                                       .....primenimo nova pravila
                                                                         


    Dodatak: Automatsko instaliranje CentOS 8 kroz grafičku instalaciju sa GUI okruženjem, dodatnim servisima i Gnome-desktopom:
  
  
    U /var/ftp/pub/ks.cfg fajlu, datom u gornjem primeru, instalacija se vrši kroz tekstualnu instalaciju a server se kreira sa minimalnim brojem servisa bez GUI
     
     
    * Ako želimo da vidimo instalaciju kroz grafički prikaz:  
     
     
     # Use text install
     text                                                                                                        .....uklonimo odrednicu za tekstuaknu instalaciju

     # Use graphical install                                                                                          
     graphical                                                                                                   .....odredimo da instalacija bude grafička              


     
    * Ako želimo da imamo instaliran GUI na mašini sa Gnome desktop-om i više instaliranih servisa, izmenimo odeljak %packagesda: 
     
     %packages --ignoremissing
     @^graphical-server-environment
     @base
     @core 
     @gnome-desktop
     @x-window-system 
     @development-and-creative-workstation
     @graphical-administration-tools
     @fonts 
     @server-with-gui

     %end                                                                                                                                                                                                                           
                                                                                                                   
                                                                                                                   
     %anaconda                                                                                                   .....a izbacimo iz fajla odeljak %anaconda
     pwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty
     pwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok
     pwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty
     %end                                                                                                               
      
      
      
     *                                                                                                              
     (yum group list                                                                                                              
     systemctl set-default graphical
     reboot)
     
 
 
~~~~~~~~~~~~~~~~~~~~~~



1.1.6. Kreiranje PXE-DNSMASQ server-a za pokretanje instalacije Windows 10 na klijentu preko samba servera
           (postupak sa kopiranjem instalacionog OS (Win10_20H2_v2_English_x64.iso) na PXE server) 

           Tokom kreiranja i pokretanja virtuelne mašine CentOS7 (VB -> Settings -> Network -> Adapter 1 -> Bridged adapter; wlan0; Advanced; allow all -> OK),
           kreiramo statičku adresu servera a onda izvršimo dhcp i tftp podešavanja
        

    sudo yum install -y dnsmasq pxelinux samba genisoimage cabextract syslinux tftp-server                             .....instaliramo neophodne programe

    sudo yum install -y http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-1.el7.nux.noarch.rpm
    
    apt-get install -y wimtools                                                                                        .....da bi smo instalirali wimtool alatku
                                                                                                                            neophodnu za instalacije windowsa,   
                                                                                                                            instaliramo prethodno nux repozitorijum

    sudo vim /etc/dnsmasq.conf                                                                .....konfigurišemo dnsmasq servis
           interface=enp0s3,lo
           bind-interfaces
           domain=boza.lab
           dhcp-range=enp0s3,192.168.0.60,192.168.0.100,255.255.255.0
           dhcp-option=3,192.168.0.1
           dhcp-option=6,192.168.0.1,8.8.8.8
           server=8.8.4.4
           dhcp-option=28,192.168.0.255
           dhcp-option=42,0.0.0.0
           dhcp-boot=pxelinux.0,pxeserver,192.168.0.50
           pxe-prompt="Press F8 for menu.", 60
           pxe-service=x86PC, "PXE Boot Menu 192.168.0.50", pxelinux
           enable-tftp
           tftp-root=/var/lib/tftpboot

    mkdir -p /var/lib/tftpboot/pxelinux.cfg                                                   .....kreiramo folder za fajl /var/lib/tftpboot/pxelinux.cfg/default
    
    sudo vim /var/lib/tftpboot/pxelinux.cfg/default                                           .....kriramo default konfiguracioni fajl za tftp i pxe za  
           MENU TITLE Network Boot Menu                                                            pokretanje instalacije windowsa
           DEFAULT menu.c32

           LABEL windows10
           MENU LABEL Windows 10
           KERNEL /memdisk
           INITRD /winpe.iso
           APPEND iso raw

    sudo cp -r /usr/share/syslinux/* /var/lib/tftpboot                                        .....iskopiramo sadržaj syslinix boot loadera u /tftpboot/

    sudo scp -r bozobuzejic@192.168.0.140:/media/bozobuzejic/2746bc9d-4aa3-4055-b3a8-53da317eb605/Programi/KB3AIK_EN.iso /home/bozo/Downloads
                                                                                              .....downloadujemo KB3AIK_EN.iso fajl neohodan za instalaciju windowsa
    sudo mkdir -p /mnt/waik                                                                   .....kreiramo folder na koji ćemo mountovati KB3AIK_EN.iso                                                   
    
    cd Downloads
    
    sudo mount KB3AIK_EN.iso /mnt/waik                                                        .....mountujemo KB3AIK_EN.iso
    
    sudo mkwinpeimg --iso --arch=amd64 --waik-dir=/mnt/waik /var/lib/tftpboot/winpe.iso       .....komandom mkwinpeimg kreiramo butabilnu pokretačku sliku
    
    sudo umount /mnt/waik                                                                     .....demontiramo KB3AIK_EN.iso iz waik foldera

    mkdir -p /var/lib/tftpboot/windows                                                        .....kreiramo windows folder u glavni folder tftpd servisa

    sudo scp -r bozobuzejic@192.168.0.140:/media/bozobuzejic/2746bc9d-4aa3-4055-b3a8-53da317eb605/Programi/Win10_20H2_v2_English_x64.iso /home/bozo/Downloads
                                                                                              .....downloadujemo verziju windowsa skinutu sa sajta
    mount Win10_20H2_v2_English_x64.iso /var/lib/tftpboot/windows                             .....montirano windows.iso fajl u folder /var/lib/tftpboot/windows 

    sudo vim /etc/samba/smb.conf                                                              .....uredimo samba konfiguracioni fajl                                                                                                               
        [global]
           workgroup = WORKGROUP
           map to guest = bad user
           usershare allow guests = yes

        [windows]
           browsable = true
           read only = yes
           guest ok = yes
           path = /var/lib/tftpboot/windows
  
     sudo systemctl restart smb  
     sudo systemctl restart nmb 
     sudo systemctl restart dnsmasq                                                            .....restarujemo samba i dnsmasq servise


     Na klijentu nakon pokretanja instalacije sa mreže:

           net use Z: \\192.168.0.50\windows
           z:\setup.exe
                                                                                                                   

~~~~~~
2.PXE - PODEŠAVANJE KLIJENATA


  
       Klijent je bilo koja mašina koja ima mogućnost mrežnog pokretanja (PXE pokretanje). Ovu opcija se podešava u Biosu.

       ili
       
       
    2.1 Klijenti: Ubuntu serveri
       
       VirtualBox -> New -> Name: Ubuntu_16 -> Memory size -> Next -> Create a virtual hard drive now -> Create -> Virtual hard drive type -> VDI -> 
                     -> Dinamically allocated -> Next -> File location and size: 10 GB -> Create

       VirtualBox -> Ubuntu_16 -> Settings -> System -> Boot order: čekirati Network, odčekirati ostalo -> 
                     -> Network -> Attached to: Bridged Adapter -> wlan0 -> Promiscuous mode: Alow all -> OK

       VirtualBox -> Označimo jednu po jednu virtualnu mašinu ili više mašina odjednom i pokrenemo ih.

       Kada instalacija os stigne do određivanja mirror-a Ubuntu arhive, strelicom prema gore doći na prvu opciju u meniju: Ručno unesite podatke - > 
       -> Enter -> izbrisati mirror i upisati IP adresu servera: 192.168.0.49 (sa kog će se vršiti instalacija) -> Enter -> Continue -> /ubuntu/ -> Continue...

       Važno - Nakon instalacije, na novoinstaliranom sistemu ažuriramo spremišta paketa (sa lokalnog izvora: 192.168.0.49 na službeni Ubuntu mirror) kako bi se 
       sistem ažurirao pomoću internet repozitorijuma:

       sudo sed -i -e 's/192.168.0.49\|security.ubuntu.com/old-releases.ubuntu.com/g' /etc/apt/sources.list 
           
           
           
    2.2 Klijenti: CentOS serveri
       
       VirtualBox -> New -> Name: Ubuntu_16 -> Memory size -> Next -> Create a virtual hard drive now -> Create -> Virtual hard drive type -> VDI -> 
                     -> Dinamically allocated -> Next -> File location and size: 10 GB -> Create

       VirtualBox -> Ubuntu_16 -> Settings -> System -> Boot order: čekirati Network, odčekirati ostalo -> 
                     -> Network -> Attached to: Bridged Adapter -> wlan0 -> Promiscuous mode: Alow all -> OK

       VirtualBox -> Označimo jednu po jednu virtualnu mašinu ili više mašina odjednom i pokrenemo ih.

       *
       Važno za CentOS 8 sa GUI: - Nakon instalacije, na novoinstaliranom sistemu pokrećemo GUI kao default opciju
       
                                   yum group list                                                                                                              
                                   systemctl set-default graphical
                                   reboot 
            
    2.3 Klijenti: Windows 10 mašine
   
       VirtualBox -> New -> Name: Windows 10 -> Memory size -> Next -> Create a virtual hard drive now -> Create -> Virtual hard drive type -> VDI -> 
                     -> Dinamically allocated -> Next -> File location and size: 60 GB -> Create

       VirtualBox -> Windows 10 -> Settings -> System -> Boot order: čekirati Network, odčekirati ostalo -> 
                     -> Network -> Attached to: Bridged Adapter -> wlan0 -> Promiscuous mode: Alow all -> OK

       VirtualBox -> Označimo jednu po jednu virtualnu mašinu ili više mašina odjednom i pokrenemo ih.
   
       Na windows klijentu, nakon pokretanja PXE menija, pokreće se windows Windows Command Line (cmd terminal):
                    
                                 net use Z: \\192.168.0.50\windows
                                 z:\setup.exe                                                   .....pokrećemo instalaciju windows-a
   
   
