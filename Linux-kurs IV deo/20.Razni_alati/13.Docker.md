
DOCKER

Docker je projekt otvorenog koda kojim kreiramo, testiramo, postavljamo i upravljamo aplikacijama u samodovoljnim prenosnim spremnicima (portable containers).
Kontejneri imaju unapred obezbeđene sve resurse koji su nekoj aplikaciji potrebni za pokretanje.
Docker omogućuje pakovanje i pokretanja aplikacije u labavom a izolovanom okruženju koje se naziva kontejner (spremnik). 
Izolacija i sigurnost omogućuju istovremeno pokretanje mnogih kontejnera na računaru domaćinu.
Docker kontejneri se koriste na lokalnom računaru, na fizičkim ili virtualnim mašinama u data centru, u oblaku i u mešovitom okruženju.

Docker je alat za raspoređivanje i upravljanje aplikacijama kao kontejnerima. 
Omogućava instaliranje aplikacija i servisa na računarima sa različitim hardverima i operativnim sistemima (čime se rešavaju probleme kompatibilnosti)
Tipične kontejnerske slike (container images) su Ubuntu, Nginx, MariaDB, WordPress i druge

Docker koristi arhitekturu klijent-server. Klijent Dockera komunicira sa Docker daemonom, koji podiže, pokreće i distribuira Docker kontejnere. 
Docker klijent i daemon mogu se izvoditi na istom sistemu ili se Docker klijent povezuje sa udaljenim Docker daemonom.

Docker daemon (dockerd) sluša zahteve za Docker API (Docker Engine -> klijent-server aplikacija) i upravlja Docker objektima poput slika, spremnika, mreža i volumena
(images, containers, networks, volumes, plugins, and other objects). 
Daemon može da komunicirati s drugim demonima kako bi upravljao Docker uslugama.

Docker registry sadrži Dockerove slike. Docker Hub je javni registar, a Docker je konfigurisan da traži slike na Docker Hubu.
Kada se izdaju naredbe za povlačenje ili pokretanje dockera (pull i run), potrebne slike se povlače iz registra.
Slika (image) je predložak (template) sa uputstvima za stvaranje Docker kontejnera. Često se  zasniva na drugoj slici, uz dodatno prilagođavanje (na primer, 
možemo kreirati sliku zasnovanu na ubuntu slici, na nju instalirati Apache web server, konfigurisati detalje potrebne za pokretanje aplikacije).
Docker images se nalaze na adresi (potrebno je kreirati account-a): https://hub.docker.com/search?image_filter=official&type=image

Kontejneri su slični virtualnim mašinama, samo troše mnogo manje resursa računara.
Kontejnere kreiramo, pokrećemo, zaustavljamo, premeštamo ili brišemo.

---

Načini instaliranja docker-a (prikazane metode se odnose na Debian 10 linux): 

   1.Uz pomoć automatizovanih skripti: za razvoj i testiranje okruženja
   
   2.Ručnim preuzimanjem, instalacijom i nadogradnjom: - pogodno za vanmrežne računare koji nemaju pristup internetu
   
   3.Iz Docker repozitorijuma: - jednostavna instalacija i nadogradnja pogodna za većinu mrežnih instalacija

   
     1.
     
     curl -fsSL https://get.docker.com -o get-docker.sh                                                .....skinemo skriptu sa navedene adrese
     sudo sh get-docker.sh                                                                             .....pokrenemo izvršenje skripte
     sudo usermod -aG docker ${USER}                                                                   .....kreiramo docker grupu i dodajemo joj aktuelnog korisnika
   
     
     2.
     
     wget https://download.docker.com/linux/debian/dists/buster/pool/stable/amd64/docker-ce_20.10.5~3-0~debian-buster_amd64.deb   .....skinemo odabranu verziju
                                                                                                                                       za Debian 10 buster linux
     sudo dpkg -i docker-ce_20.10.5~3-0~debian-buster_amd64.deb                                        .....pokrenemo instalaciju                                                                                                                         
   
   
     3. 

     sudo apt update

     sudo apt install apt-transport-https ca-certificates curl gnupg2 software-properties-common       .....instaliramo potrebne aplikacije

     curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -                      .....dodamo GPG key za Docker repository

     sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/debian $(lsb_release -cs) stable" .....add the Docker repository to the apt sources

     sudo apt update

     apt-cache policy docker-ce                                                                             .....verifikujemo pristupačne docker verzije 


     sudo apt install docker-ce                                                                             .....instaliramo najnoviju verziju docker-a
     ili
     sudo apt-get install docker-ce docker-ce-cli containerd.io
     ili                                                                                                            
     sudo apt-get install docker-ce=5:19.03.15~3-0~debian-buster docker-ce-cli=5:19.03.15~3-0~debian-buster containerd.io  .....instaliramo docker verziju koja je
                                                                                                                                kompatibilna sa minikube verzijom
                                                                                                                                "Latest validated version: 19.03"
     sudo systemctl status docker

     sudo groupadd docker                                                                              .....kreiramo docker grupu i dodajemo joj aktuelnog korisnika
     sudo usermod -aG docker ${USER}                                                                   
     ili
     sudo usermod -aG docker korisnikxy

     id -nG                                                                                            .....proverimo kojim sve grupama pripada aktuelni user

     docker                                                                                            .....izlistamo sve raspoložive komande za docker

     docker info                                                                                       .....izlistamo informacije o docker-u

     docker run hello-world                                                                            .....proveravamo pristup i preuzemamo slike s Docker Hub-a
     Hello from Docker!
     This message shows that your installation appears to be working correctly.
     ...

     sudo systemctl enable docker.service
     sudo systemctl enable containerd.service                                                          .....konfigurišemo da se docker pokreće kad i sistem
     
     /lib/systemd/system/docker.service                                                                .....konfiguracioni fajl docker servisa
     
     sudo apt-get purge docker-ce docker-ce-cli containerd.io                                          .....deinstaliramo docker 
     sudo rm -rf /var/lib/docker
     sudo rm -rf /var/lib/containerd                                                                   .....izbrišemo docker foldere
     
       
     
*Način rada:

     docker search ubuntu                                                                          .....tražimo ubuntu ​​slike na Docker Hub-u 
     ili
     docker search nginx                                                                           .....tražimo nginx ​​slike na Docker Hub-u 

     docker pull ubuntu                                                                            .....kad pronađemo odgovarajuću sliku, preuzimamo je

     docker run ubuntu                                                                             .....pokrećemo kontejner sa preuzetom slikom

     docker images                                                                                 .....izlistavamo preuzete slike na računar
     REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
     ubuntu              latest              8e428cff54c8        23 hours ago        72.9MB
     hello-world         latest              d1165f221234        2 weeks ago         13.3kB


     Primer:

     docker run -it ubuntu                                      .....pokrenemo kontejner sa slikom Ubuntu-a (-it - interaktivni pristup u spremnik sa shell-om)
     root@f09368a49cdf:/#                                       .....sada smo u virtuelnoj ubuntu mašini (koja je docker kontejner sa slikom ubuntu-a)                                                            
                                                                     (tu možemo zadavati razne komande kao u bilo kom linux-u: ls -la; cd; cat; mkdir; install itd.) 
     apt-get update
     apt-get install vim
     exit

     docker ps -a                                               .....izlistva sve kontejnere — activne i neaktivne

     docker ps -l                                               .....izlistava kreirane kontejnere
     CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
     f09368a49cdf        ubuntu              "/bin/bash"         33 minutes ago      Up 33 minutes                           interesting_bohr

     docker stop f09368a49cdf
     docker start f09368a49cdf

     docker ps                                                  .....izlistamo status kontejnera 
     docker rm f09368a49cdf                                     .....obrišemo kontejner

     docker ps -a -f status=exited                              .....izlistamo kontejnere koje smo napustili
     docker rm $(docker ps -a -f status=exited -q)              .....obrišemo kontejnere koje smo napustili

     docker ps -a -f status=exited -f status=created                 .....izlistamo kontejnere koje smo napustili a i one ostale kreirane
     docker rm $(docker ps -a -f status=exited -f status=created -q) .....obrišemo kontejnere koje smo napustili a i one ostale kreirane

     docker image prune                                              .....brišemo sve kreirane slike

     sudo docker image rm hello-world
     sudo docker image rm ubuntu                                .....obrišemo ubuntu docker image
     docker rmi $(docker images -a -q)                          .....obrišemo sve docker images
     ili
     docker image prune                                         .....obrišemo sve kreirane slike
     
     
 *SWARM (roj)
 
     Docker Swarm je grupa fizičkih ili virtualnih mašina koje rade koje su konfigursane da se udruže jedan klaster. 
     Aktivnosti klastera ili roja kontroliše upravljač roja - manager ili leader mašina, a pridružene mašine kalsteru su čvorovi (nodes) - workers u roju. 
       
     
     docker swarm init                                              .....docker inicijalizuje roj (swarm) i postavlja upravitelja (leader) u roju
     ili
     docker swarm init --advertise-addr 192.168.0.140               .....docker inicijalizuje roj (swarm) i postavlja upravitelja (leader) a ako ima više adresa na 
                                                                         različitim interfejsima, biramo na koju se priključujemo i dobijamo izlaz:
     docker swarm join --token SWMTKN-1-2409bw005rst31k22cn11sbkc2n0b674og8nppms8gazs7p45p-02bfc3pgcdvs0ylgb7rmkhshe 192.168.0.140:2377 
     
     docker swarm join-token worker                                 .....upućuje nas da na worker hostu pokrenemo token
     To add a worker to this swarm, run the following command:
     docker swarm join --token SWMTKN-1-2409bw005rst31k22cn11sbkc2n0b674og8nppms8gazs7p45p-02bfc3pgcdvs0ylgb7rmkhshe 192.168.0.140:2377
     
     docker swarm join-token manager                                .....upućuje nas da na manager hostu pokrenemo token 
     To add a manager to this swarm, run the following command:     
     docker swarm join --token SWMTKN-1-2409bw005rst31k22cn11sbkc2n0b674og8nppms8gazs7p45p-25z7wzgktvhopy3f0y3mjj3ff 192.168.0.140:2377

                                                                    
     docker swarm ca                                                .....prikazuje bezbednosni root CA sertifikat u PEM formatu
     
     docker swarm ca --rotate                                       .....rotiramo trenutni root CA sertifikat ako je roj kompromitovan (generišemo novi serifikat)
     
     docker swarm join-token --rotate worker                        .....rotiramo sertifikat na worker hostu i dobijamo novi token
     docker swarm join --token SWMTKN-1-2409bw005rst31k22cn11sbkc2n0b674og8nppms8gazs7p45p-ev9u74msi7rvxtd0yj909li2m 192.168.0.140:2377 
     
     Napomena: Navedene tokene za manager-a ili worker-a možemo pridružiti nekoj od virtuelnih mašina, (koje mogu biti kreirane i sa alatom docker-machine)
               koje onda postaju članice roja, bilo kao još jedan manager ili kao još jedan worker
     
     docker swarm leave                                             .....uključimo se na nekog člana roja i zadavanjem ove komande (iznutra, u njemu samom)
                                                                         napuštamo roj
     
     
 *NETWORK
 
     Prema zadatim postavkama postoji nekoliko pokretačkih drajvera za funkcionisanje mreže (host, bridge i user-defined bridge, none, overlay, macvlan)  
     
    -host - omogućuje vezu između kontejnera i Dockerovog domaćina, docker koristi mrežu domaćina-hosta
     
      docker run --rm -d --network host --name my_nginx nginx                    .....pokrećemo my_nginx kontejner sa nginx servisom na mreži hosta
      
            Provera (ako je aktivan apache servis, zaustaviti ga): Web browser -> http://localhost/ -> Welcome to nginx!
      
      docker container stop my_nginx                                             .....zaustavljamo my_nginx kontejner i brišemo ga zbog ugrađene --rm opcije
      
      
      
    -none - ne konfiguriše ni jednu IP adresu za kontejner i ne omogućuje pristup spoljnoj mreži kao ni drugim kontejnerima 
            (koristi se za izolovanje kontejnera od domaćina i drugih kontejnera)
       
      docker run --rm -dit --network none --name no-net-alpine alpine:latest ash     .....pokrenemo kontejner no-net-alpine sa alpine image OS bez mreže
        
      docker exec -it no-net-alpine ip link show                                     .....prikazuje da ne postoji IP adresa
       
      docker exec no-net-alpine ip route                                             .....nema odgovora jer nema IP adrese
       
      docker exec -it no-net-alpine /bin/sh                                          .....pokrenemo no-net-alpine kontejner i uđemo u alpine OS image
      / # ip a                                                                            .....ispitamo adrese - ne postoji IP adresa
       
      docker stop no-net-alpine                                                      .....izbrišemo kontejner i image alpine zaustavljanjem
       
          
     
    -bridge - bridge network se primenjuje za komunikaciju sa samostalnim - standalone kontejnerima na jednom Docker daemon domaćinu,  a za komunikaciju 
              kontejnera sa različitih domaćina može se koristiti overlay network (veza koja se obično koristi kad kreiramo roj - swarm usluge)
              (kada se pokrene Docker, bridge network se kreira automatski i novopokrenuti kontejneri se na nju povezuju - ako nije 
              drugačije naznačeno)
      
      Primer 1:
      
      docker run --rm -d --network bridge --name moj_nginx nginx                 .....kreiramo kontejner moj_nginx i nginx  i omogućujemo povezivanje na njih 
                                                                                      preko bridge network 
               docker network inspect bridge
               ...
                  {
                       "Subnet": "172.17.0.0/16",
                       "Gateway": "172.17.0.1"
                  }
               ...
                       "Containers": {
               ...
                       "IPv4Address": "172.17.0.2/16",
               ...
                  }
               ...
               
               Provera: Web browser -> http://172.17.0.2/ -> Welcome to nginx!
            
      docker network disconnect bridge moj_nginx                                 .....raskidamo vezu bridge koju koristi kontejner moj_nginx    
      docker network connect bridge moj_nginx                                    .....ponovo uspostavljamo vezu sa kontejnerom moj_nginx preko bridge
      docker container stop moj_nginx                                            .....brišemo kontejner zaustavljanjem (zbog ugrađene --rm opcije prilikom kreiranja) 
         
         
      Primer 2:      
      Pokrećemo dva različita kontejnera (alpine) na istom Docker hostu 
      
      docker run -dit --name alpine1 alpine ash
      docker run -dit --name alpine2 alpine ash                                  .....pokrenemo dva alpine kontejnera, u pozadini (-dit), bez navođenja mreže što ih 
                                                                                      automatski povezuje na defaul bridge mrežu
                                                                                      
      docker container ls
      
      docker network inspect bridge
      ...
      "Gateway": "172.17.0.1"                                                         .....kod bridge gateway ip adresa je 172.17.0.1                                           
      ...
      "IPv4Address": "172.17.0.2/16",                                                 .....ip adresa alpine1
      ...
      "IPv4Address": "172.17.0.3/16",                                                 .....ip adresa alpine2
      ...
      
      docker attach alpine1                                                      .....u jednom prozoru terminala, konektujemo se na alpine OS image preko bridge 
      / # ip a                                                                        veze i kontejnera alpine1(pošto kontejneri rade u pozadini, naredbom attach 
      ...                                                                             ulazimo na alpine OS)
      inet 172.17.0.2/16
      ...                                                                         
      
      / # ping google.com
      ...
      --- google.com ping statistics ---
      3 packets transmitted, 3 packets received, 0% packet loss
   
      / # ping 172.17.0.3
      ...
      --- 172.17.0.3 ping statistics ---
      3 packets transmitted, 3 packets received, 0% packet loss                  .....testiramo kako radi
      
      / # ping alpine2
      ping: bad address 'alpine2'

      
     docker attach alpine2                                                       .....konektujemo se na alpine OS image preko bridge veze i kontejnera alpine2                     
     / # ip a 
     ... 
     inet 172.17.0.3/16
     ...
     
     / # ping google.com
     / # ping 172.17.0.2
     / # ping alpine 1
     / # ping alpine2
      ping: bad address 'alpine2'
      
     docker container stop alpine1 alpine2
     docker container rm alpine1 alpine2 
     
     
     
    -user-defined bridge - moguće je kreiranje korisnički definisane prilagođene bridge network (user-defined bridge)
       
       
      Primer 1:
      
      docker network create buz-net                                             .....kreiramo vezu buz-net
      docker run --rm -d --network buz-net --name moj_nginx nginx               .....pokrenemo vezu buz-net, kontejner moj_nginx nginx image 
      
               docker network inspect buz-net
               ...
                  {
                       "Subnet": "172.22.0.0/16",
                       "Gateway": "172.22.0.1"                                  
                  }
               ...
                       "Containers": {
               ...
                       "IPv4Address": "172.22.0.2/16",
               ...
                 }
               ...
               
               Provera: Web browser -> http://172.22.0.2/ -> Welcome to nginx!
              
       
       docker network disconnect buz-net moj_nginx                               .....raskidamo vezu buz-net koju koristi kontejner moj_nginx         
       
       docker network connect buz-net moj_nginx                                  .....ponovo uspostavljamo vezu sa kontejnerom moj_nginx preko buz-net
          
       
       Primer 2:
    
       docker network create buz-net
       docker run --rm -d --network buz-net --name moj_nginx nginx 
       docker run --rm -d --network buz-net --name moj_nginx --publish 8080:80 nginx        
               
       docker network disconnect buz-net moj_nginx
       docker network connect buz-net moj_nginx
      
      
       Primer 3:
      
       docker network create \                                                   .....kreiramo mrežu user-def - 192.168.2.0/24  
       --driver bridge \
       --subnet 192.168.2.0/24 \
       --gateway=192.168.2.10 \
       user-def

       docker run --rm -d --name moj_nginx --publish 8080:80 nginx               .....pokrenemo kontejner moj_nginx sa forvardovanim portom 80 na 8080
       docker network connect user-def moj_nginx                                 .....konektujemo kontejner moj_nginx na user-def bridge 
       docker network inspect user-def                                           .....izlistamo informacije o user-def mreži
               ...
                  {
                       "Subnet": "192.168.2.0/24"
                       "Gateway": "192.168.2.10"
                  }
               ...
                       "Containers": {
               ...
                       "IPv4Address": "192.168.2.1/24",                              .....IP adresa kontejnera moj_nginx na nginx servisnoj slici
               ...
                 }
               ...
               
               Provera: Web browser -> http://192.168.2.1 -> Welcome to nginx!            .....pokazuje da je uspostavljena veza sa moj_nginx kontejnerom na datoj 
                                                                                               adresi
                        Web browser -> http://192.168.0.140:8080 -> Welcome to nginx!     .....pokazuje konekciju sa domaćina na moj_nginx kontejner preko porta 
                                                                                               8080 čime je omogućen pristup kontejneru sa drugih uređaja iz mreže
                                                                                               192.168.0.0/24
      
       docker network disconnect user-def moj_nginx                                  .....diskonektujemo moj_nginx sa mreže user-def
      
    
       Primer 4: 
       
       docker network create --driver bridge alpine-net
       docker network ls
       docker network inspect alpine-net
       ...
       "Subnet": "172.18.0.0/16",
       "Gateway": "172.18.0.1"                                                       .....kod user-defined bridge  gateway ip adresa je 172.18.0.1
       ...
       
       docker run -dit --name alpine1 --network alpine-net alpine ash           .....pokrećemo kontejner alpine1 na user-defined bridge mreži alpine-net

       docker run -dit --name alpine2 --network alpine-net alpine ash           .....pokrećemo kontejnere alpine2 na user-defined bridge mreži alpine-net 

       docker run -dit --name alpine3 alpine ash                                .....pokrećemo kontejner alpine3 na bridge mreži (bridge je default kad nije 
                                                                                     naznačena mreža)
       
       docker run -dit --name alpine4 --network alpine-net alpine ash           .....sa run naredbom pokrećemo kontejner alpine4 na user-defined bridge mreži 
                                                                                     alpine-net a onda se sa user-defined bridge alpine-net mreže          
       docker network connect bridge alpine4                                         prebacujemo i u bridge mrežu 
       
       
       docker container ls                                                      .....izlistavamo sva četiri kontejnera
       
       docker network inspect bridge
       ...
       "Name": "alpine3",
       "IPv4Address": "172.17.0.2/16",
       ---
       "Name": "alpine4",
       "IPv4Address": "172.17.0.3/16",                                              .....kontejneri alpine3 i alpine4 povezani su na bridge mrežu
       
       
       docker network inspect alpine-net
       ...
       "Name": "alpine2",
       "IPv4Address": "172.18.0.3/16",
       ---
       "Name": "alpine4",
       "IPv4Address": "172.18.0.4/16",
       ---
       "Name": "alpine1",
       "IPv4Address": "172.18.0.2/16",                                             .....kontejneri alpine1, alpine2 i alpine4 povezani su na alpine-net mrežu;
       ...                                                                              kontejner alpine 4 ima i bridge i alpine-net mrežu
       
       
       docker container attach alpine1                                             .....pokrenemo kontejner alpine1
       / # ping alpine2                                                                 .....pinguje
       / # ping alpine3                                                                 .....ne pinguje: bad address 'alpine3'
       / # ping alpine4                                                                 .....pinguje
       
       Kontejneri alpine1, alpine2 i alpine4 se nalaze u istoj alpine-net mreži i oni se pinguju a alpine3 se nalazi u bridge mreži i nema pingovanja 
       (ako se pokuša / # ping 172.17.0.2 - takođe nema pingovanja -> nisu u istoj mreži)
       Na user-defined bridge mreži (korisnički definisanim mrežama), poput alpine-net kontejnera, kontejneri mogu komunicirati i putem IP adresa,
       preko imena kontejnera (funkcija automatic service discovery - automatsko otkrivanje usluge) - ne funkcioniše na običnoj bridge mreži. 
       
       docker container attach alpine4          
       / #  ping alpine3                                                                .....ne pinguje: bad address 'alpine3'               
       / #  ping 172.17.0.2                                                             .....pinguje
       
       / #  ping alpine1                                                                .....pinguje 
       / #  ping alpine2                                                                .....pinguje
    
    
       docker container attach alpine3                                                  
       / #  ping alpine4                                                                .....ne pinguje: bad address 'alpine4'
       / #  ping 172.17.0.3                                                             .....pinguje                                                     
       / #  ping alpine1                                                                .....ne pinguje 
       / #  ping alpine2                                                                .....ne pinguje
       
       
    
    -overlay - overlay driver mreža stvara distribuirane mreže između više Docker domaćina,  prekriva mreže domaćina, omogućujući kontejnerima, povezanim s njom 
               (uključujući i swarm (roj) kontejnere) da bezbedno komuniciraju kada je omogućena enkripcija veze;
               kad iniciramo roj (swarm) ili pridružimo host postojećem roju, na hostu se kreiraju se dve nove mreže:
       
                  a. ingress - kontroliše promet  podataka povezanim sa rojem
                  b. docker_gwbridge - povezuje pojedinačni Docker daemon sa ostalim Docker daemonima (jednog docker domaćina sa drugim docker domaćinima)
                                       (virtualni most koji povezuje preklapajuće mreže (uključujući ingres smrežu) s fizičkom mrežom pojedinog Docker demona)
                                       
                                       
       a. ingress
       
       docker network create --driver overlay --ingress --subnet=10.11.0.0/16 --gateway=10.11.0.2 --opt com.docker.network.driver.mtu=1200 my-ingress
       .....u ingress mreži nastaloj pokretanjem roja, menjamo ip adresu subnet-a gateway-a, naziv (u my-ingress) 
       
       b. docker_gwbridge 
       
       docker network create --subnet 10.11.0.0/16 --opt com.docker.network.bridge.name=docker_gwbridge --opt com.docker.network.bridge.enable_icc=false --opt com.docker.network.bridge.enable_ip_masquerade=true docker_gwbridge
       
       
       Opšti način kreiranja mreža u overlay modu:
       
       docker network create -d overlay my-overlay                           .....kreiramo preklapajuću mrežu sa uslugom roja
       docker network create -d overlay --attachable my-attachable-overlay   .....kreiramo preklapajuću mrežu u kojoj kontejneri mogu komunicirati s drugim 
                                                                                  samostalnim kontejnerima ili u roju a koji se izvode na drugim Docker demonima
                                                                                  (na drugim mašinama) 
       docker network create --opt encrypted --driver overlay --attachable my-network .....kreiramo šifrovanu preklapajuću mrežu za komunikaciju sa drugim Docker 
                                                                                           demonima

       
       Primer:
                                       
       -Na domaćinu, na kom je instaliran docker (leader host - MX Linux) - host1                                
                                       
       sudo ufw allow 2377                                                   .....dozvolimo komunikaciju preko datog porta za upravljanja klasterom
       sudo ufw allow 7946                                                   .....dozvolimo komunikaciju preko datog porta za komunikaciju između čvorova
       sudo ufw allow 4789                                                   .....dozvolimo komunikaciju preko datog porta za preklapanje mrežnog prometa
      
       docker swarm init                                                     .....inicijalizujemo Docker-a kao upravitelja (leader) roja dobijamo izlaz:
       docker swarm join --token SWMTKN-1-2vi68p8689u9i82oy60tpcpg799m3shehknnzihp3e22ejbxhg-co07bdqv4y7xlyrnqc8qc7yq5 192.168.0.140:2377 

       ili
       
       docker swarm init --advertise-addr 192.168.0.140                      .....ako imamo više adresa na različitim interfejsima, biramo na koju se priključujemo 
       docker swarm join --token SWMTKN-1-2vi68p8689u9i82oy60tpcpg799m3shehknnzihp3e22ejbxhg-co07bdqv4y7xlyrnqc8qc7yq5 192.168.0.140:2377 
       
       
       -Na udaljenom računaru (debianBB na VirtualBox-u) - host2
       
       docker swarm join --token SWMTKN-1-2vi68p8689u9i82oy60tpcpg799m3shehknnzihp3e22ejbxhg-co07bdqv4y7xlyrnqc8qc7yq5 192.168.0.140:2377  .....iskopiramo na drugi
       
       računar u mreži - host2 (nakon instalacije Docker-a na debianbb (Debidan10 OS na VM) omogućimo pridruživanje Docker-a roju)
     
     
       docker node ls                                                        .....izlistamo node-ove, prikazuju se oba računara u roju leader i worker:
       
       ID                            HOSTNAME           STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION
       26h3467boirbskf6mpfpjjsgh *   bozomx.sytes.net   Ready     Active         Leader           20.10.5
       qawgq0rym2wx2xw2ob9nfp395     debianbb           Ready     Active                          20.10.5

       
       -Na host1:
       
       docker network create -d overlay --attachable my_net                  .....kreiramo mrežu s preklapanjem (overlay): my_net (oznaka attachable  omogućuje            
                                                                                  da se nezavisni kontejneri povežu na my_net
       docker run -it --name alpine1 --network my_net alpine                 .....kreiramo kontejner alpine1 koji je povezan sa alpine docker image preko my_net
      
       i/ili
       
       docker network create --opt encrypted -d overlay --attachable bbnet   .....kreiramo šifrovanu mrežu s preklapanjem (overlay) bbnet
       docker run -it --name buz1 --network bbnet alpine                     .....kreiramo kontejner buz1 koji je povezan sa alpine docker image preko bbnet
       
       
       -Na host2:
       
       sudo docker run -it --name alpine2 --network my_net alpine:latest ash .....kreiramo kontejner alpine2 koji je povezan sa alpine docker image preko
                                                                                  my_net overlay mrežom kreiranom u host1)
       i/ili
       
       sudo docker run -it --name alpine2 --network my_net alpine:latest ash .....kreiramo kontejner buz2 koji je povezan sa alpine docker image preko
                                                                                  bbnet overlay mrežom kreiranom u host1)
                                                                                       
       Provera:
       
       -Na host1

        ping alpine2
           PING alpine2 (10.0.8.4): 56 data bytes
           4 packets transmitted, 4 packets received, 0% packet loss
        
       -Na host2
       
        ping alpine1 
           PING alpine1 (10.0.8.2): 56 data bytes
           4 packets transmitted, 4 packets received, 0% packet loss
        
        ili
        
        ping buz2   (na hostu1)
        ping buz1   (na hostu2)
        
        
     
    -macvlan - Macvlan mreže omogućuju dodijelu MAC adresu kontejnerima, čime se oni prikazuju kao fizički uređaji na mreži; koristi se kad kontejneri treba da   
              izgledaju kao fizički domaćini na mreži, svaki s jedinstvenom MAC adresom
   
        docker network create -d macvlan \
        --subnet=172.16.86.0/24 \
        --gateway=172.16.86.1 \
        -o parent=eth0 \
        my-macvlan-net                                     .....kreiramo macvlan mrežu my-macvlan-net koja ima svoj opseg IP adresa, gateway i koja se premošćuje  
                                                                datim fizičkim mrežnim intefejsom (eth0, wlam0...)
                                                                                                                       
        docker run --rm -dit \
        --network my-macvlan-net \
        --name my-macvlan-alpine \
        alpine:latest \
        ash                                               .....pokrenćemo alpine kontejner i i povezujemo ga na my-macvlan-net mrežu                        
                                            
        docker container inspect my-macvlan-alpine
        
        docker exec my-macvlan-alpine ip addr show eth0                                                             
        
        docker exec my-macvlan-alpine ip route            .....proverimo kako kontejner vidi svoj mrežni interfejs 
                                                                     
        docker container stop my-macvlan-alpine
        docker network rm my-macvlan-net                  .....zaustavimo i uklonimo my-macvlan-net mrežu 
        
        
        docker network create -d macvlan \
        --subnet=192.168.32.0/24 \
        --ip-range=192.168.32.128/25 \
        --gateway=192.168.32.254 \
        --aux-address="my-router=192.168.32.129" \
        -o parent=eth0 macnet32                           .....kreiramo macvlan mrežu macnet32 ali izostavimo (--aux-address) adresu rutera (192.168.32.129)
  
  
*VOLUME

     Volumeni su mehanizam za trajno čuvanje podatke koje generšu i koriste Docker kontejneri
     
     
     Kreiranje i upravljanje volumenima: 
     
     Primer 1:
     Kreiramo kontejner sa volumenom
     
     docker volume create myVolumen                             .....kreiramo volumen myVolumen
     docker volume ls                                           .....izlistamo sve volumene kreirane sa docker-om
     docker volume inspect myVolumen                            .....pregledamo stvoreni volumen
     docker volume rm myVolumen                                 .....uklonimo volumen myVolumen
     docker volume prune                                        .....uklanja sve volumene
     
     Primer 2:
     Startujemo kontejner sa volumenom
     
     docker run -d \                                            .....pokrenemo kontejner s volumenom koji još ne postoji - Docker kreira volumen mojvolumen i
     --name devtest \                                                montira ga u /app/ kontejner i preuzima kontejnere sa poslednjom verzijom aplikacije nginx
     --mount source=mojvolumen,target=/app \                         .....u primeru se koristi komanda --mount nakon koje oređujemo izvor (source) i ciljanu
     nginx:latest                                                         destinaciju (target)
   
     ili
     
     docker run -d \                                                
       --name devtest \
       -v mojvolumen:/app \                                          .....mojvolumen je source a /app target
       nginx:latest
   
  
     docker inspect devtest                                     .....potvrđuje da je volumen kreiran i montiran - prikazan odeljak Mounts
     "Mounts": [                                                     prikazuje izvor i odredište i da je na njemu moguće čitanje i pisanje ("RW": true)
        "Type": "volume",
        "Name": "mojvolumen",
        "Source": "/var/lib/docker/volumes/mojvolumen/_data",
        "Destination": "/app",
        "Driver": "local",
        "Mode": "",
        "RW": true,
        "Propagation": ""
     }

     docker container stop devtest                             .....zaustavimo kontejner 
     docker container rm devtest                               .....uklonimo kontejner (uklanjamo uslugu a ne volumen)
     docker volume rm mojvolumen                               .....uklonimo volumen (uklanjanje volumena je poseban korak)
     
     Primer 3:
     Kreiranje volumena samo za čitanje (bez mogućnosti unošenja promena)
     
     docker run -d \
     --name=nginxtest \
     --mount source=nginx-vol,destination=/usr/share/nginx/html,readonly \
     nginx:latest
     
     docker inspect nginxtest                                       .....potvrdimo da je volumen kreiran i montiran kako je naznačeno u komandi
     ... 
     "RW": false,                                                        .....prikazan red iz odeljka Mounts
     ...
     
     docker container stop nginxtest
     docker container rm nginxtest
     docker volume rm nginx-vol
     
     Primer 4:
     Popunjavnje volumena pomoću kontejnera
     Pokrećemo nginxs kontejner i popunjavamo novi volumen "nginx-vol" sadržajem iz default foldera za web servis: /usr/share/nginx/html i aktiviramo taj HTML 
     sadržaj (putanja do /var/lib/docker/volumes/nginx-vol/_data/index.html stranice u doscker-u)
     
     docker run -d \                                                .....kreiramo kontejner nginxtest i volumen nginx-vol koji montiramo u folder 
     --name=nginxtest \                                                  /usr/share/nginx/html (ujedno instalirajući kontejner sa aplikacijom nginx)
     --mount source=nginx-vol,destination=/usr/share/nginx/html \
     nginx:latest
  
     docker inspect nginxtest                                       .....potvrdimo da je volumen kreiran i montiran kako je naznačeno u komandi
     ...
     "IPAddress": "172.17.0.2"                                      .....pogledamo ip adresu nginx servera i proverimo na web browser-u da li nas vodi
     ...                                                                 do index stranice nginx servisa (http://172.17.0.2) -> Welcome to nginx!)
     
     
     docker container stop nginxtest                                .....zaustavimo kontejner 
     docker container rm nginxtest                                  .....uklonimo kontejner
     docker volume rm nginx-vol                                     .....uklonimo volumen, proverimo na web browser-u: http://172.17.0.2->This site can’t be reached 
     
   
    
     - Pokretanje servisa sa volumenom
     
     docker service create -d \
       --replicas=4 \
       --name devtest-service \
       --mount source=myvol2,target=/app \
       nginx:latest                                                .....pokreće nginx uslugu s četiri replike, a svaka koristi volumen mojvolumen
     
     docker service ps devtest-service                             .....izlistamo sadržaj devtest-service i vidimo da sadrži 4 kontejnera sa nginx-om
     docker service rm devtest-service                             .....uklonimo uslugu
     docker volume rm mojvolumen
     
     
     - PLUGIN i SHARE
     
     1. Kreiranje i pokretanje volumena pomoću volume driver-a
     
     a.
     
     Plugin SSHFS (SSH fajl sistem) služi za montiranje foldera sa udaljenih računara, preko SSH veze (SSHFS koristi SFTP protokol, koji je podsistem SSH)
     
     docker plugin install --grant-all-permissions vieux/sshfs           .....povlačimo dodatak (plugin) iz Docker Hub-a, instaliramo ga i dodeljujemo mu dozvole
     ili
     docker plugin install vieux/sshfs                                   .....u interaktivnom modu povlačimo (plugin) iz Docker Hub-a, pita nas za dozvole
     
     
     b.
     
     docker volume create --driver vieux/sshfs \                         .....kriramo volumen sshvolume i plugin kontejner  vieux/sshfs, konfigurišemo ga da se 
     -o sshcmd=dbuser@192.168.0.200:/home/dbuser/share \                      konektuje na folder /home/dbuser/share udaljenog računara debianbb u mreži  
     -o password=password \                                                   (debian 10 u VB)
     sshvolume                                                            
   
     ili 
     
     docker volume create --driver vieux/sshfs -o sshcmd=dbuser@192.168.0.200:/home/dbuser/share -o password=dbpassword sshvolume  
     
     c. 
     
     docker run -it -v sshvolume:/data busybox                           .....kreiramo image kontejner busybox i pokrećemo volumen sshvolume u /data folderu 
                                                                              busybox-a
     / # ls -la data                                                          .....ušli smo u busybox i proveravamo sadržaj foldera /data   
     drwxrwxrwx    1 1000     1001          4096 Apr  2 18:59 .
     drwxr-xr-x    1 root     root          4096 Apr  2 18:57 ..
     -rw-r--r--    1 1000     1001            10 Apr  2 18:53 proba1.txt           ....prikazuje sadržaj foldera /home/bozo/share sa udaljenog računara debianbb
                                                                                       kog smo mountovali u /data folder busybox-a
     / # touch proba2.txt                                                              .....kreiramo fajl proba2.txt u u /data folderu busybox-a 
     
     / # exit                                                                          .....izlazimo iz busybox-a
     
     
     Provera: Prebacimo se u folder /home/dbuser/share na  udaljenom računaru debianbb -> vidimo da su se folderi sinhonizovali: 
              oba fajla, proba1.txt i proba2.txt se nalaze i u /data busybox-a i u /home/dbuser/share debianbb-a                                                             
 
     Napomena 
     Na domaćinu se fajlovi nalaze u folderu: 
     var/lib/docker/plugins/213c12e5d4a8369c315f96c25676f492ee8b4ace37bba0dbfd46001371bdae2a/propagated-mount/f2f004d07dbdc3a3154ee5d670b2a45c/
     
     
     2. Kreiranje servisa sa kreiranjem NFS volumena 
     
     2.1. Kreiranje i montiranje nekog foldera sa domaćina na docker volumen na Docker hostu
          
     
     Na mašini domaćina (host1: MX linux)
      
     sudo vim /etc/exports
             /home/mxuser/nfs/test  192.168.0.1/24(rw,sync,no_root_squash,no_subtree_check)
     sudo exportfs -a
     sudo service nfs-kernel-server start
     

     mkdir -p /home/mxuser/nfs/test
     touch /home/mxuser/nfs/test/test1.txt

     docker volume create --opt type=nfs --opt device=:/home/mxuser/nfs/test --opt o=addr=192.168.0.140  volume_test  .....kreiramo nfs docker volumen volume_test na               
                                                                                                                           mašini host1 (192.168.0.140) na koji 
                                                                                                                           montiramo folder  /home/user1/nfs/test
                                                                                               
     docker volume inspect volume_test                                                      .....testiramo volumen volume_test
     
     docker run -it -v volume_test:/data alpine ash                                         .....pokrenemo volume_test koji se montira na /data folder
     #/                                                                                          docker image alpine OS i ulazimo na alpine OS
     #/ touch data/testX.txt                                                                     .....na alpine, u folderu data kreiramo fajl testX.txt                                                              
     #/ ls data                                                                                  .....kad izlistamo sadržaj data foldera na alpine, vidimo u njemu
     test1.txt  testX.txt                                                                             test1.txt i testX.txt fajlove
     
     #/ exit                                                                                     .....izlazimo iz alpine OS
     
     ls /home/mxuser/nfs/test                                                               .....kad izlistamo sadržaj /home/mxuser/nfs/test foldera vidimo u njemu
     test1.txt testX.txt                                                                         test1.txt i testX.txt fajlove
     

     ls /var/lib/docker/volumes/volume_test/_data                                           .....ako proverimo, vidimo da se fajlovi test1.txt i testX.txt nalaze
     test1.txt testX.txt                                                                         u /var/lib/docker/volumes/volume_test/_data folderu docker 
                                                                                                 konfiguracije 
                                                                                                  
                                                                                                  
     2.2. Kreiranje servisa sa kreiranjem NFS volumena sa udaljene mašine na domaćina
          Kreiranje i montiranje nekog foldera sa udaljene mašine (host2) na docker volumen na Docker hostu (host1)
          
          
     Na udaljenoj mašini (host2: debian 10, na VirtualBox-u):
     
     sudo vim /etc/exports
             /home/debuser/nfs/test1  192.168.0.1/24(rw,sync,no_root_squash,no_subtree_check)
     sudo exportfs -a
     sudo service nfs-kernel-server start
     
     mkdir -p /home/debuser/nfs/test1
     touch /home/debuser/nfs/test1/testY.txt
     
     
     
     Na mašini domaćina (host1: MX linux):
     
     docker volume create --opt type=nfs --opt device=:/home/debuser/nfs/test1 --opt o=addr=192.168.0.200  vol_deb                                                                                              
     
     docker run -it -v vol_deb:/data alpine ash                                             .....pokrenemo volume_test koji se montira na /data folder
     #/                                                                                          docker image alpine OS i ulazimo na alpine OS
     #/ touch data/testZ.txt                                                                     .....na alpine, u folderu data kreiramo fajl testZ.txt 
     #/ ls data                                                                                  .....izlistamo data folder na alpine i u njemu vidimo fajlove 
     testY.txt  testZ.txt                                                                             testY.txt  testZ.txt
     #/ exit                                                                                     .....izađemo iz alpine OS
     
     ls /var/lib/docker/volumes/vol_deb/_data                                               .....ako proverimo, vidimo da se fajlovi testY.txt i testZ.txt nalaze
     testY.txt  testZ.txt                                                                        u /var/lib/docker/volumes/vol_deb/_data folderu docker-a
     
     
     Na udaljenoj mašini (host2: debian 10):
     ls /home/debuser/nfs/test1                                                             .....kad izlistamo sadržaj /home/dbuser/nfs/test1 foldera vidimo u njemu
     testY.txt  testZ.txt                                                                        testY.txt i testZ.txt fajlove
   

   
     3. Montiranje Samba share direktno u docker bez konfigurisanja tačke montiranja na domaćinu
     
     docker volume create \
     --driver local \
     --opt type=cifs \
     --opt device=//192.168.0.200/dbuser/share \
     --opt o=addr=192.168.0.200,username=dbuser,password=dbpassword,file_mode=0777,dir_mode=0777 \
     mediashare                                                                                      .....kreiramo volumen mediashare sa CIFS i određujemo da će se
                                                                                                          deliti /dbuser/share folder sa udaljenog
                                                                                                          računara (ip: 192.168.0.200 - debian 10 u VirtualBox-u)
                                                                                                          preko mediashare volumena na Docker hostu 
                                                                                                           
     docker run -it --rm -v mediashare:/data -d --name samba-client alpine ash                  .....pokrećemo kontejner samba-client i montiranje volumena 
                                                                                                     mediashare u /data folder na docker alpine image
     docker exec -it samba-client /bin/ash                                                      .....uključimo se na kontejner samba-client na docker image
     / #                                                                                             alpine
     / # ls data                                                                                     .....izlistamo data folder na alpine OS i vidimo montiran
     proba1.txt  proba2.txt                                                                               sadržaj /home/dbuser/share foldera sa udaljene mašine
                                                                                                          (sa host2)
     
     ls /var/lib/docker/volumes/mediashare/_data                                                .....ako proverimo, vidimo da se fajlovi proba1.txt i proba2.txt 
     proba1.txt  proba2.txt                                                                          nalaze u /var/lib/docker/volumes/mediashare/_data folderu 
                                                                                                     docker-a
                                                                                                 
                                                                                                          
     - BACKUP i RESTORE:
       Backup and restore data volumes  
     
     
     a) Backup
     
     docker run -it --name dbstore -v dbdata:/newvolume alpine ash    .....kreiramo dbstore ubuntu, na njemu kreiramo folder newvolume a dbdata volume u
                                                                           /var/lib/docker/volumes/ i montiramo dbdata volumen u folder newvolume 
     / #                                                                   -> što nas uključuje na dbstore ubuntu image ->
     / # ls
     / # touch newvolume/proba1.txt                                        .....kreiramo proba1.txt fajl u folderu newvolume 
     exit                                                                  .....izlazimo iz dbstore alpine image
     
     
     pwd                                                              .....pogledamo u kom folderu na domaćinu se nalazimo:
     /home/mxuser/share
     
     docker run --rm --volumes-from dbstore -v $(pwd):/backup alpine tar cvf /backup/backup.tar newvolume   .....sa dbstore ubuntu kreiramo backup.tar fajl od 
                                                                                                                 newvolume foldera na alpine docker image, u folder
                                                                                                                 u kome smo, na domaćinu
     ls /var/lib/docker/volumes/dbdata/_data                          .....ako proverimo, vidimo da se fajl proba1.txt nalazi u  
     proba1.txt                                                            /var/lib/docker/volumes/dbdata/_data folderu docker-a           
     
     
     
     docker start dbstore                                             .....ponovo pokrenemo kontejner dbstore     
     
     docker exec -it dbstore /bin/ash                                 .....uključimo se na kontejner dbstore u docker image alpine OS 
     / #
     / # rm newvolume/proba1.txt                                           .....obrišemo proba1.txt fajl iz foldera newvolume
     exit                                                                  .....izlazimo iz dbstore alpine image  
     
     ls /var/lib/docker/volumes/dbdata/_data                          .....ako proverimo, vidimo da se fajl proba1.txt više ne nalazi u  
                                                                           /var/lib/docker/volumes/dbdata/_data folderu docker-a
    
     
     b) Restore
     
     
     cd share                                                        .....prebacimo se u folder u kom smo bili kad je kreiran backup.tar fajl (backup komprimovan
                                                                          sadržaj foldera newvolume na alpine docker image)
                                                                          
     docker run --rm --volumes-from dbstore -v $(pwd):/backup alpine ash -c "cd newvolume && tar xvf /backup/backup.tar --strip 1" 
     
     .....pokrenemo kontejner dbstore, iz foldera u kome smo, na domaćinu, prebacimo se u newvolume folder alpine image i u njemu raspakujemo backup.tar fajl   
                         
             
             
     docker start dbstore                                            .....pokrenemo kontejner dbstore (iz tačke a) Backup)    
     
     docker exec -it dbstore /bin/ash                                .....uključimo se na kontejner dbstore u docker image alpine OS
     / #
     / # ls newvolume/                                                    .....vidimo da je restauriran fajl proba1.txt u folder newvolume u alpine image
     proba1.txt                    
     
     ls /var/lib/docker/volumes/dbdata/_data                         .....ponovo proverimo i vidimo da se fajl proba1.txt ponovo nalazi u  
                                                                          /var/lib/docker/volumes/dbdata/_data folderu docker-a
                
                
*DOCKER COMPOSE

     Compose je alat za definisanje i pokretanje Docker aplikacija s više kontejnera.
     Sa Compose se koristi YAML fajl za konfigurisanje aplikacije.
     Ako Docker uključuje više kontejnera (na primer: web server i data-base server u posebnim kontejnerima), Docker Compose ih povezuje preko YAML fajla. 
     Kada konfigigurišemo YAML fajl, jednom naredbom možemo kreirati, pokrenuti i konfigurisati sve kontejnere.
     
     
     Instaliramo docker-compose:
     
     sudo curl -L "https://github.com/docker/compose/releases/download/1.28.6/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose                            
         
         
     sudo chmod +x /usr/local/bin/docker-compose                              .....dodamo izvršne dozvole (+x) 
        
     sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose         .....kreiramo link docker-compose do /usr/bin/docker
     
     
     docker-compose --version                                                 .....izlistamo podatke o verziji docker-compose
     

     Korišćenje Compose funkcije iz tri koraka:

     1. Definišemo okruženje aplikacije kao dockerfile koji se može koristiti bilo gde.

     2. U docker-compose.yml definišemo usluge neke aplikacije kako bi se aplikacija pokretala u izolovanom okruženju.

     3. Pokrećemo funkciju sa docker compose up, čime se pokreće aplikacija.
     
     
     
     Primer 1)
     
     mkdir my_machine                                           .....kreiramo direktorijum projekta
     cd my_swarm-manager_machine                                .....premestimo se u folder my_machine  
     
     vim docker-compose.yml                                     .....u docker-compose.yml fajlu definišemo koje će servise (kontejnere) pokretati docker 
     version: '3.9'
     services:
            web:
          image: dockercloud/hello-world:latest
            ports:
            - 8800:80

     
     curl localhost:8800                                                                 
     ili        
     Web browser -> http://localhost:8800/ -> Hello world! My hostname is c27b9e33c697   .....proverimo i vidimo da je kontejner sa image dockercloud/hello-world
                                                                                              pokrenuta i da funkcioniše: vidimo sadržaj stranice index.html
     
     Primer 2:
     
     mkdir my_wordpress                                         .....kreiramo direktorijum projekta
     cd my_wordpress                                            .....premestimo se u folder  my_wordpress  
     
     vim docker-compose.yml                                     .....u docker-compose.yml fajlu definišemo koje će servise (kontejnere) pokretati docker 
        version: "3.9"                                               (mysql i wordpress)
        services:
            db_node_domain:
          image: mysql:5.7                                           .....kreiramo image mysql:5.7 pod imenom wp_test_db
          volumes:
            - db_data:/var/lib/mysql
          restart: always
          environment:
            MYSQL_ROOT_PASSWORD: somewordpress
            MYSQL_DATABASE: wordpress
            MYSQL_USER: wordpress
            MYSQL_PASSWORD: wordpress
          container_name: wp_test_db 
    
        wordpress:
          depends_on:
            - db_node_domain
          image: wordpress:latest                                    .....kreiramo image wordpress:latest pod imenom wp_test
            ports:
            - '8080:80'
          expose:
            - 80
          restart: always
          environment:
             VIRTUAL_HOST: blog.example.com
             LETSENCRYPT_HOST: blog.example.com
             LETSENCRYPT_EMAIL: foo@example.com
             WORDPRESS_DB_HOST: db_node_domain:3306
             WORDPRESS_DB_USER: wordpress
             WORDPRESS_DB_PASSWORD: wordpress
             WORDPRESS_DB_NAME: wordpress
          container_name: wp_test    
          volumes:
          db_data: 
          
          networks:
             default:
        
     docker-compose up -d                                       .....pokrećemo docker-compose.yml i kreiramo images, containers, volumes i network
     
     
     Provera:

     Web browser -> http://localhost:8000 -> otvara se početna stranica za konfiguraciju wordpress-a
     
                                                  
     docker-compose down                                        .....uklanja spremnike i zadatu mrežu, ali čuva vašu WordPress bazu podataka
     docker-compose down --volumes                              .....uklanja spremnike, zadatu mrežu i WordPress bazu podataka

     
     Napomena: Kreirani kontejneri iz oba primera su postavljeni da rade na lokalnom domaćinu. Kontejneri se mogu postaviti i na udaljenu mašinu
               (primer dat u odeljku *DOCKER MACHINE - Konfiguracija nekog servisa na docker mašini sa  docker-compose alatom i docker-compose.yml fajlom)
                                                                                                              
 Vežba:
   
      1. Kreiramo volumen myvolume
      2. Montiramo volumen myvolume na docker ubuntu image (kreirajući kontejner volumecontainer i docker ubuntu image u isto vreme)
      3. Delimo podatake između kontejnera korišćenjem volumena myvolume (kreirajući kontejner volumecontainer1 i docker ubuntu image u isto vreme)
      4. Montiramo direktorijum sa domaćina, kao volumena, u kontejner data1 (kreirajući ga u isto vreme sa docker ubuntu image)
      5. Uklanjamo volumene (prethodno zaustavljamo i uklanjamo kontejnere volumecontainer, volumecontainer1 i data1)
  
    1.Kreiranje volumena myvolume
  
     docker volume create myvolume                                                             .....kreiramo volumena pod nazivom myvolume
     docker inspect myvolume                                                                   .....pregledamo volumen
  
  
    2.Montiranje volumena myvolume
  
     docker run -it --name=volumecontainer --mount source=myvolume,destination=/data ubuntu    .....u interaktivnom modu povlačimo Ubuntu image iz Docker Hub-a, 
                                                                                                    pokrenemo kontejner pod nazivom volumecontainer
                                                                                                    i montiramo myvolume kontejner na /data
                                                                                                    unutar /var/lib/docker/volumes/myvolume/_data/ direktorijuma 
                                                                                                    prebacujemo se u kreiranu sliku Ubuntu-a:
     root@e82189545025:/# ls                                                                   .....izlistamo sadržaj foldera u kome se nalazimo na Ubuntu                                                                                     
     echo "This is a test file!" > /data/file.txt                                              .....kreiramo file.txt fajl u /data folderu Ubuntu-a
     exit                                                                                      .....izlazimo iz Ubuntu-a     
  
     docker container start volumecontainer                                                    .....ponovo pokrenemo volumecontainer
  
     docker exec -it volumecontainer /bin/bash                                                 .....priključimo se u tekući kontejner sa Ubuntu-om:
     root@e82189545025:/# cat data/file.txt                                                    .....pregledamo fajl koji smo kreirali 
  
     ls /var/lib/docker/volumes/myvolume/_data/
     cat /var/lib/docker/volumes/myvolume/_data/file.txt                                       .....pregledamo fajl koji smo kreirali

  
    3.Deljenje podataka između kontejnera korišćenjem volumena myvolume
  
     docker run -it --name=volumecontainer1 --mount source=myvolume,destination=/data ubuntu   .....kreiramo novi kontejner - volumecontainer1 kojim montiramo  
                                                                                                   myvolume volumen (u /data folder na docker ubuntu image)  
     root@2457d03d97ba:/# ls                                                                                               
     root@2457d03d97ba:/# cat /data/file.txt                                                   .....učitavamo fajl
  
  
    4.Montirnje direktorijuma sa domaćina, kao volumena, u kontejner data1
   
   
     4.a.
    
     mkdir /Share                                                                              .....kreiramo folder Share u home folder root-a (/) na sistemu 
                                                                                                    domaćina 
   
     cd /Share
     sudo touch file1.txt file2.txt file3.txt                                                  .....premestimo se u folder /Share i kreiramo tri .txt fajla
   
     docker run -it --name=data1 -v /Share:/Data ubuntu                                        .....kreiramo kontejner ubuntu data1 kojim montiramo (-v) folder 
                                                                                                    /Share iz sistema domaćina u folder /Data na docker ubuntu  
     root@cc4bf9311dd8:/# ls -la Data                                                          .....proverimo stanje: vidimo fajlove file1.txt, file2.txt i file3.txt
    
    
    4.b.
    
     docker run -it -v "$(pwd)":/data1 ubuntu                                                  .....kreiramo kontejner kojim montiramo (-v) folder u kome smo na 
                                                                                                    sistemu domaćina u folder /data1 na docker ubuntu  
     root@3947cf900628:/# ls -la data1                                                         .....proverimo stanje 
    
    
    5.Uklanjanje docker volumena 
   
     docker container stop volumecontainer volumecontainer1                                    .....prvo zaustavimo kontejnere (volumecontainer, volumecontainer1)
     docker container rm volumecontainer volumecontainer1
     docker volume rm myvolume                                                                 .....uklonimo volumen myvolume
    
     docker container rm data1                                                                 .....uklonimo kontejner data1
     docker volume rm Data                                                                     .....uklonimo volumen Data
    
    
    
 *DOCKER MACHINE
 
     Docker-machine je alat koji omogućuje instaliranje Docker Engine-a na virtualne hostove i upravljanje hostovima pomoću docker-machine naredbi.
     
     Docker-machine naredbama možetmo pokrenuti, pregledati, zaustaviti i ponovo pokrenuti virtualni host, nadograditi Docker klijenta i daemon i konfigurisati. 
     
     Docker klijenta da komunicira sa domaćinom.
     
     Docker-machine pruža efikasan način upravljanja sa više Docker hostova na mreži, u oblaku ili lokalno.
     
     Docker-machine može kreirati Docker daemon na različitim platformama za virtualizaciju i cloud. 
     
     
     
    -Primer: Kreiranje roja (swarm) od tri virtuelne mašine: 1 manager mašina i 2 workers mašine u VirtualBox-u
     
     Na mašini domaćinu, na kojoj imamo instaliran VirtualBox (MX linux):
  
     curl -L https://github.com/docker/machine/releases/download/v0.16.2/docker-machine-`uname -s`-`uname -m` >/tmp/docker-machine &&
     chmod +x /tmp/docker-machine && sudo cp /tmp/docker-machine /usr/local/bin/docker-machine .....instaliramo docker-machine
     
     docker-machine create -d virtualbox swarm-manager                                          .....u VirtualBox-u kreiramo virtuelnu mašinu swarm-manager
     
     docker-machine stop swarm-manager                                                          .....komanda za zaustavljanje neke docker mašine
     docker-machine start swarm-manager                                                         .....komanda kojom pokrećemo neku docker mašinu
      
     (docker-machine rm -f $(docker-machine ls -q)                                              .....komanda kojom izbrišemo sve docker mašine
      ili
      docker-machine rm swarm-manager                                                           .....komanda kojom izbrišemo naznačenu mašinu)
     
     docker-machine ssh swarm-manager                                                           .....uključujemo se na virtuelnu docker mašinu swarm-manager:
     docker@swarm-manager:~$ ip a                                                                    .....prikaz ip adrese mašine swarm-manager
     ...
     inet 192.168.99.102/24 brd 192.168.99.255 scope global eth1
     ...
     docker@swarm-manager:~$ docker swarm init --advertise-addr 192.168.99.102                  .....swarm-manager (current node - manager) pokreće stvaranje roja u 
                                                                                                     kome će pojedinačno, svakom članu roja (worker) dodeljivati ip 
                                                                                                     adrese s tim što će manager izabrati svoju postojeću ip adresu
                                                                                                     (--advertise-addr 192.168.99.102) pa dobijamo izlaz:
                                                                                                     
     docker swarm join --token SWMTKN-1-2a2vwohncj0bnlgcj0a96rtnd7eczreiafo8geh6jq152ccugr-b8gtx6fidwv97kjg57y4uzobq 192.168.99.102:2377  .....token koji kopiramo
                                                                                                                                               na workers mašine 
                 


     - Otvorimo nove prozore na terminalu domaćina i kreiramo dva Docker demona kao worker-a:                                                                                                
     
     docker-machine create -d virtualbox swarm-0
  
     docker-machine create -d virtualbox swarm-1
     
     
     - Dodajemo worker mašine u roj kopiranjem i lepljenjem tokena kreiranog u mašini manager-u roja 
     
     docker-machine ssh swarm-0                                                                 .....konektujemo se na mašinu swarm-0
     
     docker@swarm-0:~$ docker swarm join --token SWMTKN-1-2a2vwohncj0bnlgcj0a96rtnd7eczreiafo8geh6jq152ccugr-b8gtx6fidwv97kjg57y4uzobq 192.168.99.102:2377
     .....iskopiramo na drugu mašinu u mreži: swarm-0 (host2 / worker1 u Docker roju na VirtalBox-u)
     
     docker-machine ssh swarm-1
     docker@swarm-1:~$ docker swarm join --token SWMTKN-1-2a2vwohncj0bnlgcj0a96rtnd7eczreiafo8geh6jq152ccugr-b8gtx6fidwv97kjg57y4uzobq 192.168.99.102:2377
     .....iskopiramo na treću mašinu u mreži: swarm-1 (host3 / worker2 u Docker roju na VirtalBox-u)
     
     docker-machine ls                                                                                              .....izlistamo spisak mašina koje smo kreirali
     NAME            ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER      ERRORS
     swarm-0         -        virtualbox   Running   tcp://192.168.99.103:2376           v19.03.12   
     swarm-1         -        virtualbox   Running   tcp://192.168.99.104:2376           v19.03.12   
     swarm-manager   *        virtualbox   Running   tcp://192.168.99.102:2376           v19.03.12 
     
     docker-machine active                                                                                          .....komanda za izlistavanje aktivnih mašina
     swarm-manager                                                                                                       (aktvna je ona kojoj kreiramo okruženje)
     
     
     - Postavljnje varijabli okruženja (environment variables) za trenutni shell na VM swarm-manager
     
     docker-machine env swarm-manager
     export DOCKER_TLS_VERIFY="1"
     export DOCKER_HOST="tcp://192.168.99.102:2376"
     export DOCKER_CERT_PATH="/home/mxuser/.docker/machine/machines/swarm-manager"
     export DOCKER_MACHINE_NAME="swarm-manager"
     # Run this command to configure your shell: 
     # eval $(docker-machine env swarm-manager)
     
     eval $(docker-machine env swarm-manager)                              .....komanda postavlja varijable okruženja za trenutni shell koju Docker mašina koristi
     
     env|grep DOCKER                                                       .....izlistamo i prikažemo varijable okruženja za shell koje smo postavili
     DOCKER_TLS_VERIFY=1
     DOCKER_CERT_PATH=/home/mxuser/.docker/machine/machines/swarm-manager
     DOCKER_MACHINE_NAME=swarm-manager
     DOCKER_HOST=tcp://192.168.99.102:2376 
     
     
     - Ukidanje postavljenih environment variables za trenutni shell na VM swarm-manager
     
     I način: 
     
     unset DOCKER_TLS_VERIFY
     unset DOCKER_CERT_PATH
     unset DOCKER_MACHINE_NAME
     unset DOCKER_HOST                                                     .....komande za ukidanje svake od varijabli pojedinačno
     
     
         Primer ukidanja varijable naziva:
         
         unset DOCKER_MACHINE_NAME                                             
     
         env|grep DOCKER                                                        .....izlistamo i prikažemo varijable okruženja i vidimo da nema DOCKER_MACHINE_NAME     
         DOCKER_TLS_VERIFY=1
         DOCKER_CERT_PATH=/home/mxuser/.docker/machine/machines/swarm-manager
         DOCKER_HOST=tcp://192.168.99.102:2376
     
         eval $(docker-machine env swarm-manager)                               .....ponovo uspostavimo sve varijable za mašinu swarm-manager (mašina postaje 
                                                                                     aktivna)
         env|grep DOCKER                                                        .....izlistamo i prikažemo varijable okruženja i vidimo da su opet sve prisutne
         DOCKER_TLS_VERIFY=1
         DOCKER_CERT_PATH=/home/mxuser/.docker/machine/machines/swarm-manager
         DOCKER_MACHINE_NAME=swarm-manager
         DOCKER_HOST=tcp://192.168.99.102:2376
     
     
     II način:
     
     docker-machine env -u                                                      .....komanda kojom prikazujemo koje varijable možemo da ukinemo ili pojedinačno:
     unset DOCKER_TLS_VERIFY
     unset DOCKER_HOST
     unset DOCKER_CERT_PATH
     unset DOCKER_MACHINE_NAME
     # Run this command to configure your shell: 
     # eval $(docker-machine env -u)                                                 .....ili sve odjednom

     eval $(docker-machine env -u)                                              .....komanda kojom brišemo sve postavke okruženja za shell mašine swarm-manager
                                                                                     sve mašine postanu neaktivne
     
     - Prikaz IP adresa svakog od kreiranih hostova
     
     docker-machine ip swarm-manager
     192.168.99.102
     
     docker-machine ip swarm-0
     192.168.99.103
     
     docker-machine ip swarm-1
     192.168.99.104
     
     
     - Pokretanje Nginx webserver servisa na kontejneru koji kreiramo za mašinu koja je predvodnik (leader) roja: swarm-manager
     
     docker run -d -p 8000:80 nginx                                                        .....kreiramo docker kontejner nginx koji će da radi na portu 8000
     
     curl $(docker-machine ip swarm-manager):8000                                          .....prikažemo index.html stranicu nginx
     ili
     Web browser -> http://192.168.99.102:8000/ -> Welcome to nginx!                       .....proverimo i na web browser-u domaćina:
                                                                                                - na ip adresi swarm-manager-a, na portu 8000 vidimo 
                                                                                                default web stranicu koju postavlja nginx web servis
                                                                                                
                                                                                                
     - Konfiguracija nekog servisa na docker mašini sa  docker-compose alatom i docker-compose.yml fajlom                                                                                           
     
     mkdir my_swarm-manager_machine                             .....kreiramo direktorijum projekta
     
     cd my_swarm-manager_machine                                .....premestimo se u folder my_swarm-manager_machine i sve ostale radnje izvodimo odatle  
     
     vim docker-compose.yml                                     .....u docker-compose.yml fajlu definišemo koje će servise (kontejnere) pokretati docker 
     version: "3.9"
     services:
         web:
           image: dockercloud/hello-world:latest
           ports:
             - 8800:80
     
     docker-compose up -d                                                                  .....pokrećemo izvršenje docker-compose.yml fajla na domaćinu
     
     curl localhost:8800                                                                   .....prikažemo index.html stranicu dockercloud/hello-world
     ili        
     Web browser -> http://localhost:8800/ -> Hello world! My hostname is c27b9e33c697     .....proverimo i na web browser-u domaćina:
                                                                                                - na ip adresi domaćina, na portu 8800 vidimo 
                                                                                                web stranicu koju je postavio dockercloud/hello-world kontejner
     docker-compose down                                                                   .....uklonimo kontejner
     
     
     
     docker-machine start swarm-manager                                                    .....startujemo virtuelnu mašinu swarm-manager 
     
     eval $(docker-machine env swarm-manager)                                              .....postavljamo varijable okruženja za trenutni shell swarm-manager 
                                                                                                mašine
     docker-machine ip swarm-manager                                                       .....izlistamo ip adresu swarm-manager mašine
     192.168.99.102
     
     docker-machine active                                                                 .....izlistamo prikaz aktivnih mašina (onih kojima smo postavili
     swarm-manager                                                                              varijable okruženja
     
     docker-compose up -d                                                                  .....ponovo pokrećemo izvršenje docker-compose.yml fajla 
     
     curl localhost:8800                                                                   .....ne možemo da prikažemo index.html stranicu dockercloud/hello-world 
     curl: (7) Failed to connect to localhost port 8800: Connection refused                     na lokalnoj adresi domaćina 
     ili
     Web browser -> http://localhost:8800/ -> This site can’t be reached localhost refused to connect.  .....proverimo i na web browser-u domaćina:
                                                                                                             ne možemo da prikažemo index.html stranicu na adresi
                                                                                                             domaćina
     curl $(docker-machine ip swarm-manager):8800                                          .....prikažemo index.html stranicu dockercloud/hello-world na ip adresi
     ili                                                                                        swarm-manager mašine na navedenom portu (192.168.99.102:8800) 
     Web browser -> http://192.168.99.102:8800/ -> Hello world! My hostname is d7e358f3ab24     .....proverimo i na web browser-u domaćina:
                                                                                                     - na ip adresi swarm-manager, na portu 8800 vidimo  web 
                                                                                                     stranicu koju je postavio dockercloud/hello-world kontejner
      Web browser nekog drugog uređaja u lokalnoj mreži -> http://192.168.0.140:8800            .....prikazuje se stranica sa kontejnera                                                                                
    
    
     -  Kopiranje nekog fajla sa domaćina u home folder neke virtuelne docker-machine
        
        docker-machine scp /home/mxuser/share/backup.tar swarm-manager:~/                  .....pokrenemo kopiranje backup.tar fajla iz /home/mxuser/share/ foldera
                                                                                                sa domaćina u home (~/) folder virtuelne swarm-manager (ili neke 
                                                                                                druge) mašine
        docker-machine ssh swarm-manager                                                   .....sa ssh se priključimo na virtuelnu swarm-manager mašinu
        docker@swarm-manager:~$ ls                                                              .....izlistamo fajlove iz home foldera swarm-manager mašine i vidimo
        backup.tar                                                                                   da je fajl iskopiran

        
        
     -  Kopiranje nekog fajla sa neke virtuelne docker-machine u neki folder na domaćinu 
    
        docker-machine scp swarm-manager:~/backup.tar /home/mxuser/Documents/             .....pokrenemo kopiranje backup.tar fajla iz home (~/) foldera
                                                                                               swarm-manager mašine u /home/mxuser/Documents/ folder domaćina
        ls /home/mxuser/Documents/                                                             .....izlistamo fajlove u /home/mxuser/Documents/ i vidimo da je
        backup.tar                                                                                  fajl iskopiran
        